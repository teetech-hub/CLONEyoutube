(function(g){var window=this;'use strict';var W0m=function(D){var O=new g.OX("und",new g.M5("Default","und",!0));O.captionTracks=D.captionTracks;return O},Ta_=function(D){return new g.fH(function(O,h){var V=D.length,k=[];
if(V)for(var C=function(Y,J){V--;k[Y]=J;V==0&&O(k)},M=function(Y){h(Y)},c,S=0;S<D.length;S++)c=D[S],g.$kR(c,g.Bq(C,S),M);
else O(k)})},df=function(D){this.D=D},zD=function(){df.apply(this,arguments)},d8x=function(){zD.apply(this,arguments)},zt_=function(){zD.apply(this,arguments)},nZ8=function(){zD.apply(this,arguments)},F00=function(){zD.apply(this,arguments)},ybS=function(){zD.apply(this,arguments)},iwv=function(){df.apply(this,arguments)},rb9=function(){zD.apply(this,arguments)},pl9=function(){zD.apply(this,arguments)},Nae=function(){zD.apply(this,arguments)},oZ8=function(){zD.apply(this,arguments)},Zwe=function(){zD.apply(this,
arguments)},XlS=function(){zD.apply(this,arguments)},Ba9=function(){zD.apply(this,arguments)},lkC=function(){zD.apply(this,arguments)},x8c=function(){zD.apply(this,arguments)},$8_=function(){zD.apply(this,arguments)},IkC=function(){zD.apply(this,arguments)},Di_=function(){zD.apply(this,arguments)},OnR=function(){df.apply(this,arguments)},h5c=function(){zD.apply(this,arguments)},VJ9=function(){zD.apply(this,arguments)},k$e=function(){zD.apply(this,arguments)},C2m=function(){zD.apply(this,arguments)},
MJ9=function(){zD.apply(this,arguments)},bnC=function(){zD.apply(this,arguments)},cMm=function(){zD.apply(this,arguments)},SFm=function(){zD.apply(this,arguments)},YFR=function(){zD.apply(this,arguments)},JMC=function(){df.apply(this,arguments)},qF9=function(){df.apply(this,arguments)},uSR=function(){df.apply(this,arguments)},HnU=function(){zD.apply(this,arguments)},mim=function(){zD.apply(this,arguments)},e5L=function(){zD.apply(this,arguments)},LRC=function(){zD.apply(this,arguments)},P2R=function(){zD.apply(this,
arguments)},g3R=function(){zD.apply(this,arguments)},R5c=function(){zD.apply(this,arguments)},aPx=function(){zD.apply(this,arguments)},fP0=function(){zD.apply(this,arguments)},KRL=function(){zD.apply(this,arguments)},E3R=function(){zD.apply(this,arguments)},jQe=function(){zD.apply(this,arguments)},UiS=function(){zD.apply(this,arguments)},AM_=function(){zD.apply(this,arguments)},G$c=function(){zD.apply(this,arguments)},tJv=function(){zD.apply(this,arguments)},v3x=function(){zD.apply(this,arguments)},
QQx=function(){zD.apply(this,arguments)},wPm=function(){zD.apply(this,arguments)},sQ0=function(){zD.apply(this,arguments)},WR_=function(){zD.apply(this,arguments)},TV8=function(){zD.apply(this,arguments)},diR=function(){zD.apply(this,arguments)},z5C=function(){zD.apply(this,arguments)},n3C=function(){zD.apply(this,arguments)},FR9=function(){df.apply(this,arguments)},yMv=function(){zD.apply(this,arguments)},inS=function(){zD.apply(this,arguments)},rMm=function(){zD.apply(this,arguments)},pPc=function(){zD.apply(this,
arguments)},NVm=function(){zD.apply(this,arguments)},o3e=function(){zD.apply(this,arguments)},Zn9=function(){zD.apply(this,arguments)},XPx=function(){zD.apply(this,arguments)},BVR=function(){zD.apply(this,arguments)},lPL=function(){zD.apply(this,arguments)},xi0=function(){zD.apply(this,arguments)},$i_=function(){zD.apply(this,arguments)},IPC=function(){zD.apply(this,arguments)},D2J=function(){zD.apply(this,arguments)},O6_=function(){zD.apply(this,arguments)},hOR=function(){zD.apply(this,arguments)},
V0R=function(){zD.apply(this,arguments)},kp9=function(){zD.apply(this,arguments)},CX8=function(){zD.apply(this,arguments)},M0m=function(){zD.apply(this,arguments)},b6J=function(){zD.apply(this,arguments)},cwJ=function(){zD.apply(this,arguments)},Sq0=function(){zD.apply(this,arguments)},Yqc=function(){zD.apply(this,arguments)},Jw9=function(){zD.apply(this,arguments)},qqJ=function(){zD.apply(this,arguments)},uY_=function(){zD.apply(this,arguments)},H6R=function(){zD.apply(this,arguments)},m29=function(){zD.apply(this,
arguments)},eOU=function(D){D=D.key||D.id;
if(!D)throw Error("Entity key is missing");return D},LwJ=function(){if(nC)return nC();
var D={};nC=g.bc("PersistentEntityStoreDb",{Wh:(D.EntityStore={zU:1},D.EntityAssociationStore={zU:2},D),shared:!1,upgrade:function(O,h){h(1)&&g.rN(g.dN(O,"EntityStore",{keyPath:"key"}),"entityType","entityType");h(2)&&(O=g.dN(O,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.rN(O,"byParentEntityKey","parentEntityKey"),g.rN(O,"byChildEntityKey","childEntityKey"))},
version:3});return nC()},PXS=function(D){return g.x9(LwJ(),D)},gYJ=function(D){return g.x9((0,g.Iv8)(),D)},FV=function(D){this.token=D},y2=function(D,O){O=O===void 0?{}:O;
g.D3.call(this,g.D3m[D],Object.assign({},{name:"PESEncoderError",type:D},O));this.type=D;this.level="WARNING";Object.setPrototypeOf(this,y2.prototype)},ROm=function(D){return new y2("WRONG_DATA_TYPE",{Cj:D})},aTC=function(D){return D instanceof Error?new y2("UNKNOWN_ENCODE_ERROR",{WP:D.message}):new y2("UNKNOWN_ENCODE_ERROR")},fTR=function(D){return D instanceof Error?new y2("UNKNOWN_DECODE_ERROR",{WP:D.message}):new y2("UNKNOWN_DECODE_ERROR")},KwS=function(D,O){D=D instanceof y2?D:O(D);
g.yK(D);throw D;},EYm=function(){},jKm=function(D,O,h){try{return D.j(O,h)}catch(V){KwS(V,aTC)}},U29=function(D){D=(new TextEncoder).encode(D).subarray(0,16);
var O=new Uint8Array(16);O.set(D);return O},ia=function(D){this.D=D},Gpe=function(D){var O=AwR[D];
if(O)return O;g.iZ(new g.D3("Entity model not found.",{entityType:D}))},t0v=function(D,O){this.D=D;
this.K=O;this.j={}},QK_=function(D,O){a:{D=vYc(D.K,O.version);
try{var h=D.K(O.data,O.key);break a}catch(V){KwS(V,fTR)}h=void 0}return h},rf=function(D,O,h){return D.D.objectStore("EntityStore").get(O).then(function(V){if(V){if(h&&V.entityType!==h)throw Error("Incorrect entity type");
return QK_(D,V)}})},pC=function(D,O,h){return h?(h=h.map(function(V){return rf(D,V,O)}),g.vs.all(h)):D.D.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(O)).then(function(V){return V.map(function(k){return QK_(D,k)})})},oN=function(D,O,h){var V=eOU(O),k=vYc(D.K,1),C=Object.assign({},O);
return D.D.objectStore("EntityStore").get(V).then(function(M){if(M){if(M.entityType!==h)throw Error("Incorrect entity type");C.entityMetadata||(M=QK_(D,M),C.entityMetadata=M.entityMetadata)}}).then(function(){var M={key:V,
entityType:h,data:jKm(k,C,V),version:1};return g.vs.all([g.FE(D.D.objectStore("EntityStore"),M),wSR(D,C,h)])}).then(function(){NN(D,V,h);
return V})},sKx=function(D,O,h){O=O.map(function(V){return oN(D,V,h)});
return g.vs.all(O)},ZM=function(D,O,h){if(h==null?0:h.XW){var V=new Set;
return Wwm(D,O,V).then(function(){for(var C=[],M=g.P(V),c=M.next();!c.done;c=M.next())C.push(ZM(D,c.value));return g.vs.all(C).then(function(){})})}var k=g.Yy(O).entityType;
return g.vs.all([D.D.objectStore("EntityStore").delete(O),T0R(D,O)]).then(function(){NN(D,O,k)})},d28=function(D,O){return g.Z3(D.D.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(O)},function(h){return g.vs.all([h.delete(),
T0R(D,h.cursor.primaryKey)]).then(function(){NN(D,h.cursor.primaryKey,O);return g.NQ(h)})})},zOS=function(D,O,h,V){var k=vYc(D.K,1);
return rf(D,O,V).then(function(C){if(C){C=g.vD(C,h);var M={key:O,entityType:V,data:jKm(k,C,O),version:1};return g.vs.all([g.FE(D.D.objectStore("EntityStore"),M),wSR(D,C,V)])}}).then(function(){NN(D,O,V);
return O})},NN=function(D,O,h){var V=D.j[h];
V||(V=new Set,D.j[h]=V);V.add(O)},nYL=function(D,O,h){var V=eOU(O);
h=Gpe(h);if(!h)return g.vs.resolve([]);h=new h(O);D=D.D.objectStore("EntityAssociationStore");O=[];h=g.P(h.K());for(var k=h.next();!k.done;k=h.next())O.push(g.FE(D,{parentEntityKey:V,childEntityKey:k.value}));return g.vs.all(O).then(function(C){return C.map(function(M){return M[1]})})},T0R=function(D,O){return D.D.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(O))},wSR=function(D,O,h){var V=eOU(O);
return T0R(D,V).then(function(){return nYL(D,O,h)})},Wwm=function(D,O,h){if(h.has(O))return g.vs.resolve(void 0);
h.add(O);return FwR(D,O).then(function(V){return D.D.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(O)).then(function(){return V})}).then(function(V){var k=g.vs.resolve(void 0);
V=g.P(V);for(var C=V.next(),M={};!C.done;M={tA:void 0},C=V.next())M.tA=C.value,k=k.then(function(c){return function(){return Wwm(D,c.tA,h)}}(M));
return k}).then(function(){})},FwR=function(D,O){var h=D.D.objectStore("EntityAssociationStore");
return h.index("byParentEntityKey").getAll(IDBKeyRange.only(O)).then(function(V){var k=[];V=g.P(V);for(var C=V.next();!C.done;C=V.next())C=C.value,k.push(h.index("byChildEntityKey").getAll(C.childEntityKey));return g.vs.all(k)}).then(function(V){var k=[];
V=g.P(V);for(var C=V.next();!C.done;C=V.next())C=C.value,C.length===1&&k.push(C[0].childEntityKey);return k})},XV=function(){},ywv=function(){this.D={};
this.D[0]=new XV;if(!g.AO("aes_pes_encoder_killswitch")){var D=this.D;try{var O=g.Ok();var h=U29(O);var V=new ia(new g.Uz(h),new g.jS(h))}catch(k){throw D=k instanceof Error?new y2("KEY_CREATION_FAILED",{WP:k.message}):new y2("KEY_CREATION_FAILED"),g.yK(D),D;}D[1]=V}},vYc=function(D,O){O=O===void 0?0:O;
D=D.D[O];if(!D)throw O=new y2("INVALID_ENCODER_VERSION",{Cj:O}),g.yK(O),O;return D},Bv=function(D,O){g.n.call(this);
this.token=D;this.D=O;this.observers=[];D=new g.zR.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.Ok());D.onmessage=this.K.bind(this);this.channel=D},la=function(D,O,h){var V,k,C,M;
return g.Q(function(c){if(c.D==1)return g.t(c,PXS(D.token),2);if(c.D!=3)return V=c.K,g.t(c,g.nQ(V,["EntityStore","EntityAssociationStore"],O,function(S){k=new t0v(S,D.D);return h(k)}),3);
C=c.K;k&&(M=k.j,Object.keys(M).length>0&&(D.channel.postMessage(M),i68(D,M)));return c.return(C)})},xD=function(D,O,h){return la(D,{mode:"readwrite",
g2:!0},function(V){return oN(V,O,h)})},rwL=function(D,O){return la(D,{mode:"readwrite",
g2:!0},function(h){return sKx(h,O,"offlineOrchestrationActionWrapperEntity")})},pSv=function(D,O){return la(D,{mode:"readwrite",
g2:!0},function(h){return ZM(h,O)})},N0v=function(D){return la(D,{mode:"readwrite",
g2:!0},function(O){return d28(O,"videoPlaybackPositionEntity")})},$D=function(D,O,h){return la(D,{mode:"readonly",
g2:!0},function(V){return rf(V,O,h)})},IN=function(D,O,h){return la(D,{mode:"readonly",
g2:!0},function(V){return pC(V,O,h)})},i68=function(D,O){D=g.P(D.observers);
for(var h=D.next();!h.done;h=D.next())h=h.value,h(O)},oY0=function(){var D,O,h;
return g.Q(function(V){if(V.D==1)return g.g2(V,2),g.t(V,g.CL(),4);if(V.D!=2){D=V.K;if(!D||!g.hl()||typeof g.zR.BroadcastChannel==="undefined")return V.return();O=new ywv;return V.return(new Bv(D,O))}h=g.fT(V);h instanceof Error&&g.yK(h);return V.return()})},Da=function(){Z6c||(Z6c=oY0());
return Z6c},XS8=function(D){var O;
D=(O=D.options)==null?void 0:O.persistenceOption;return D==="ENTITY_PERSISTENCE_OPTION_PERSIST"||D==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},B0c=function(D){var O;
return g.Q(function(h){return h.D==1?g.t(h,Da(),2):(O=h.K)?g.t(h,la(O,"readwrite",function(V){for(var k={},C=g.P(D),M=C.next(),c={};!M.done;c={x_:void 0,VB:void 0},M=C.next())c.x_=M.value,c.x_.entityKey&&XS8(c.x_)&&(c.VB=g.Ap(c.x_.payload),M=void 0,c.x_.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(M=function(S){return function(){return oN(V,S.x_.payload[S.VB],S.VB)}}(c)),c.x_.type==="ENTITY_MUTATION_TYPE_DELETE"&&(M=function(S){return function(){return ZM(V,S.x_.entityKey)}}(c)),c.x_.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(M=function(S){return function(){return zOS(V,S.x_.entityKey,S.x_.payload[S.VB],S.VB)}}(c)),M&&(k[c.x_.entityKey]=k[c.x_.entityKey]?k[c.x_.entityKey].then(M):M()));
return g.vs.all(Object.values(k))}),0):h.return()})},lTc=function(D){var O;
return g.Q(function(h){if(h.D==1){O=D.mutations;if(!O||O.length<=0)return h.return();if(g.cM){var V={type:"ENTITY_LOADED"};O!==void 0&&(V.payload=O);g.cM.dispatch(V)}return g.t(h,B0c(O),2)}O.length=0;g.LT(h)})},x2S=function(D){return D!==void 0},$2x=function(D){var O=g.jq();
O=Object.assign({},O);D=Object.assign({},D);for(var h in O)D[h]?(O[h]!==4&&(O[h]=D[h]),delete D[h]):O[h]!==2&&(O[h]=4);Object.assign(O,D);g.Zym(O);JSON.stringify(O);return O},ITR=function(D){var O,h;
return g.Q(function(V){if(V.D==1)return g.t(V,g.CL(),2);if(V.D!=3)return(O=V.K)?g.t(V,g.Gl(O),3):V.return();h=V.K;return V.return(g.nQ(h,["index","media","captions"],{mode:"readwrite",g2:!0},function(k){var C=IDBKeyRange.bound(D+"|",D+"~");k=[k.objectStore("index").delete(C),k.objectStore("media").delete(C),k.objectStore("captions").delete(C)];return g.vs.all(k).then(function(){})}))})},D0U=function(){var D,O;
return g.Q(function(h){if(h.D==1)return g.t(h,g.CL(),2);if(h.D!=3){D=h.K;if(!D)throw g.G9("rvdfd");return g.t(h,g.Gl(D),3)}O=h.K;return h.return(g.nQ(O,["index","media"],{mode:"readwrite",g2:!0},function(V){var k={};return g.pQ(V.objectStore("index"),{},function(C){var M=C.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),c=g.vs.resolve(void 0);if(M){var S=M[1];M=M[2];k[S]=k[S]||{};var Y;k[S][M]=g.$sd((Y=C.getValue())==null?void 0:Y.fmts)}else c=C.delete().then(function(){});
return g.vs.all([g.NQ(C),c]).then(function(J){return g.P(J).next().value})}).then(function(){for(var C={},M=g.P(Object.keys(k)),c=M.next();!c.done;c=M.next()){c=c.value;
var S=k[c].v;C[c]=k[c].a&&S?1:2}var Y=$2x(C);return g.QZk(V.objectStore("media"),{},function(J){var q=J.cursor.key.match(g.hMP);q&&C[q[1]]||V.objectStore("media").delete(J.cursor.key);return g.fxk(J)}).then(function(){return Y})})}))})},Osx=function(D,O){var h,V;
return g.Q(function(k){if(k.D==1)return g.t(k,g.CL(),2);if(k.D!=3){h=k.K;if(!h)throw g.G9("wct");return g.t(k,g.Gl(h),3)}V=k.K;return g.t(k,g.nQ(V,["captions"],{mode:"readwrite",g2:!0},function(C){var M=[];C=C.objectStore("captions");for(var c=0;c<O.length;c++){var S=g.FE(C,O[c],D+"|"+O[c].metadata.vss_id);M.push(S)}return g.vs.all(M)}),0)})},hlx=function(D){var O,h,V;
return g.Q(function(k){if(k.D==1)return O=IDBKeyRange.bound(D+"|",D+"~"),g.t(k,g.CL(),2);if(k.D!=3){h=k.K;if(!h)throw g.G9("gactfv");return g.t(k,g.Gl(h),3)}V=k.K;return k.return(V.getAll("captions",O))})},Vov=function(D){return g.Q(function(O){g.A1(D,0);
return O.return(ITR(D))})},kO9=function(D){return{context:g.f_(),
videoIds:D}},C$S=function(D){return{context:g.f_(),
playlistIds:D}},Mo0=function(D){return{context:g.f_(),
offlinePlaylistSyncChecks:D}},bsR=function(){this.D=new Map},SyU=function(){cu_||(cu_=new bsR);
return cu_},Yy9=function(D,O){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:D},metadata:O,statusCode:void 0,csn:void 0,can:void 0}},Ju_=function(D,O,h){if(!h){var V=V===void 0?!1:V;
h=D.D.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!h||V)h=g.v9(16),D.D.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",h)}D={flowNonce:h,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:O.eventType};O.metadata&&(D.flowMetadata=O.metadata);O.statusCode!==void 0&&(D.flowEventStatus=O.statusCode);O.csn&&(D.csn=O.csn);O.can&&(D.can=O.can);g.eL("flowEvent",D,void 0)},qyc=function(D){var O,h,V,k,C,M,c,S,Y,J,q,u,H,m,R,f,E,A,v,W,z,X,Z,hd,Yw,B,r,I,L,p,Id,aL,hx,Ad,OS,eR,lW,K,U,G;
return g.Q(function(w){if(w.D==1)return g.t(w,la(D,{mode:"readonly",g2:!0},function(d){return pC(d,"playbackData").then(function(Dy){var MP=Dy.map(function(Pq){return Pq.transfer}).filter(function(Pq){return!!Pq}),kw=Dy.map(function(Pq){return Pq.offlineVideoPolicy}).filter(function(Pq){return!!Pq}),T=Dy.filter(function(Pq){return!!Pq.key}).map(function(Pq){return g.Jg(g.Yy(Pq.key).entityId,"downloadStatusEntity")});
MP=pC(d,"transfer",MP);kw=pC(d,"offlineVideoPolicy",kw);T=pC(d,"downloadStatusEntity",T);var Jd=MP.then(function(Pq){Pq=Pq.reduce(function(bW,Wq){(Wq==null?0:Wq.offlineVideoStreams)&&bW.push.apply(bW,g.a(Wq.offlineVideoStreams));return bW},[]).filter(function(bW){return!!bW});
return pC(d,"offlineVideoStreams",Pq)});
return g.vs.all([MP,kw,Jd,T]).then(function(Pq){var bW=g.P(Pq);Pq=bW.next().value;var Wq=bW.next().value;var b_=bW.next().value;bW=bW.next().value;return[Dy,Pq,Wq,b_,bW]})})}),2);
if(w.D!=3)return O=w.K,g.t(w,la(D,{mode:"readonly",g2:!0},function(d){return pC(d,"mainDownloadsListEntity").then(function(Dy){var MP,kw;return(kw=(MP=Dy[0])==null?void 0:MP.downloads)!=null?kw:[]})}),3);
h=w.K;V=g.P(O);k=V.next().value;C=V.next().value;M=V.next().value;c=V.next().value;S=V.next().value;Y=k;J=C;q=M;u=c;H=S;m={};R={};f={};E={};A={};v=[];W=g.P(J);for(z=W.next();!z.done;z=W.next())(X=z.value)&&(m[X.key]=X);Z=g.P(q);for(hd=Z.next();!hd.done;hd=Z.next())(Yw=hd.value)&&(R[Yw.key]=Yw);B=g.P(H);for(r=B.next();!r.done;r=B.next())(I=r.value)&&(f[I.key]=I);L=g.P(u);for(p=L.next();!p.done;p=L.next())(Id=p.value)&&(E[Id.key]=Id);aL=g.P(h);for(hx=aL.next();!hx.done;hx=aL.next())Ad=hx.value,OS=void 0,
A[(OS=Ad.videoItem)!=null?OS:""]=!0,Ad.videoItem&&(lW=eR=void 0,K=(lW=(eR=g.Yy(Ad.videoItem))==null?void 0:eR.entityId)!=null?lW:"",v.push({externalVideoId:K}));U=Y.filter(function(d){if(!d||!d.key||!d.offlineVideoPolicy)return!1;d=g.Yy(d.key).entityId;d=g.Jg(d,"downloadStatusEntity");var Dy;return!(d&&((Dy=f[d])==null?void 0:Dy.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
G=U.map(function(d){var Dy=m[d.transfer],MP=[];if(Dy==null?0:Dy.offlineVideoStreams)for(var kw=g.P(Dy.offlineVideoStreams),T=kw.next();!T.done;T=kw.next())(T=E[T.value])&&MP.push(T);kw=R[d.offlineVideoPolicy];T=A;var Jd=d==null?void 0:d.playerResponseTimestamp,Pq=g.Yy(kw.key).entityId;d=g.Jg(Pq,"mainVideoEntity");if(kw.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var bW="OFFLINE_VIDEO_STATE_DISABLED";kw.expirationTimestamp&&Number(kw.expirationTimestamp)<Date.now()/1E3&&(bW="OFFLINE_VIDEO_STATE_EXPIRED")}else if(kw.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")bW="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(Dy==null?void 0:Dy.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":bW="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":bW="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":bW="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":bW="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":bW="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":bW="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:bW="OFFLINE_VIDEO_STATE_UNKNOWN"}if(bW==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(Dy==null?void 0:Dy.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":bW="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":bW="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":bW=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}Pq={id:Pq,videoState:bW};if(Dy==null?0:Dy.cotn)Pq.cotn=Dy.cotn;if(Dy==null?0:Dy.maximumDownloadQuality)Pq.selectedVideoQuality=Dy==null?void 0:Dy.maximumDownloadQuality;if(Dy==null?0:Dy.lastProgressTimeMs)Pq.lastProgressTimeMs=Dy.lastProgressTimeMs;Jd&&(Pq.playerResponseSavedTimeMs=String(Number(Jd)*1E3));Dy=String;Jd=0;MP=g.P(MP);for(bW=MP.next();!bW.done;bW=MP.next())if(bW=bW.value,bW.streamsProgress){bW=g.P(bW.streamsProgress);for(var Wq=bW.next();!Wq.done;Wq=
bW.next()){var b_=void 0;Jd+=Number((b_=Wq.value.numBytesDownloaded)!=null?b_:0)}}Pq.downloadedBytes=Dy(Jd);Pq.selectedOfflineMode=T[d]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";kw.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(Pq.offlinePlaybackDisabledReason=kw.offlinePlaybackDisabledReason);return Pq});
return w.return({offlineVideos:G,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:v}}})})},uBx=function(){this.locks=navigator.locks},Hs8=function(){try{var D=g.Fk("ytglobal.locks_");
if(D)return D;var O;if(O=navigator){var h=navigator;O="locks"in h&&!!h.locks}if(O)return g.zR.localStorage&&g.zR.localStorage.getItem("noop"),D=new uBx,g.nT("ytglobal.locks_",D),D}catch(V){}},Ox=function(){},m00=function(){},elc=function(D){if(D.includes(":"))throw Error("Invalid user cache name: "+D);
return D+":"+g.Ok("CacheStorage get")},Ln9=function(){return g.Q(function(D){if(h_!==void 0)return D.return(h_);
h_=new Promise(function(O){var h;return g.Q(function(V){switch(V.D){case 1:return g.g2(V,2),g.t(V,Vh.open("test-only"),4);case 4:return g.t(V,Vh.delete("test-only"),5);case 5:g.ad(V,3);break;case 2:if(h=g.fT(V),h instanceof Error&&h.name==="SecurityError")return O(!1),V.return();case 3:O("caches"in window),g.LT(V)}})});
return D.return(h_)})},gBU=function(){return g.Q(function(D){if(D.D==1)return g.t(D,Ln9(),2);
if(!D.K)return D.return(void 0);P$L||(P$L=new m00);return D.return(P$L)})},ku=function(D,O,h){g.iZ(new g.D3("Woffle: "+D,h?{cotn:h}:""));
O instanceof Error&&g.iZ(O)},Rlx=function(D){var O;
return g.Q(function(h){if(h.D==1)return g.t(h,qyc(D),2);O=h.K;g.eL("offlineStateSnapshot",O);g.LT(h)})},CB=function(D){g.n.call(this);
var O=this;this.api=D;this.HF={BIi:function(){return O.D},
cDw:function(){return O.K}};
typeof g.zR.BroadcastChannel!=="undefined"&&(this.D=new g.zR.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.Ok()),this.D.onmessage=this.j.bind(this),this.K=new g.zR.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.Ok()),this.K.onmessage=this.W.bind(this))},ML=function(D,O){D.api.F1("onOfflineOperationFailure",O);
var h;(h=D.D)==null||h.postMessage(O)},aoR=function(D,O,h,V){var k=this;
this.T=D;this.U=O;this.visibility=h;this.S=V;this.J=this.L=this.Z=this.j=this.D=!1;this.W=new g.kF(function(){k.iJ()});
this.HF={Ty:function(){return k.K},
iJ:function(){k.iJ()},
Zo1:function(){return k.W}};
this.visibility.subscribe("visibilitystatechange",function(){k.D9()})},fox=function(D){if(!D.j&&!D.D){var O=Hs8();
if(O){D.j=!0;var h=g.Ok("OfflineLockManager");O.request("woffle_orchestration_leader:"+h,{},function(){var V,k,C,M;return g.Q(function(c){switch(c.D){case 1:return g.g2(c,2),D.K=new g.jh,D.D=!0,D.j=!1,g.t(c,D.T(),4);case 4:return g.t(c,D.K.promise,5);case 5:g.ad(c,0);break;case 2:V=g.fT(c),((C=(k=D).S)==null?0:C.call(k,"wo_relinquish_leadership_on_lock_request_error"))||D.iJ(),V instanceof Error&&(M=V,M.args=[{name:"WoLockManagerError",IG:V.name}],g.yK(M)),g.LT(c)}})})}}},KnR=function(D){D.D&&(D.J=
!0,b1(D))},EBL=function(D,O){D.D&&(D.Z=O,b1(D))},jHx=function(D,O){D.D&&(D.L=O,b1(D))},b1=function(D){D.L&&D.Z&&D.J&&D.visibility.isBackground()?g.Cd(D.W,6E4):D.W.stop()},cm=function(D){var O;
D.offlineDeleteReason=(O=D.offlineDeleteReason)!=null?O:"OFFLINE_DELETE_REASON_UNKNOWN";var h;D.offlineModeType=(h=D.offlineModeType)!=null?h:"OFFLINE_NOW";g.eL("offlineDeleteEvent",D)},Sp=function(D,O){var h=O.videoId;
var V=O.B8;O=O.offlineModeType;D.encryptedVideoId=h;D.cotn=V==null?void 0:V.cotn;D.offlineabilityFormatType=V==null?void 0:V.maximumDownloadQuality;var k;D.isRefresh=(k=V==null?void 0:V.isRefresh)!=null?k:!1;var C;D.softErrorCount=(C=V==null?void 0:V.transferRetryCount)!=null?C:0;D.offlineModeType=O!=null?O:"OFFLINE_NOW";(D.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&D.statusType==="UNKNOWN_STATUS_TYPE"||!D.transferStatusType&&!D.statusType)&&g.iZ(Error("Woffle unknown transfer status"));
g.eL("offlineTransferStatusChanged",D)},U0J=function(D,O,h,V){V={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!V};O&&h&&(O=Math.floor(O/1024).toFixed(),h=Math.floor(h/1024).toFixed(),V.alreadyDownloadedKbytes=O,V.totalFetchedKbytes=O,V.totalContentKbytes=h);Sp(V,D)},Auv=function(D){Sp({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},D)},GOe=function(D){switch(D){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
Yu=function(D){var O,h,V;
return((V=(O=D.actionMetadata)==null?void 0:(h=O.retryScheduleIntervalsInSeconds)==null?void 0:h.length)!=null?V:0)>0},J_=function(D){return D.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!D.entityKey},qL=function(D){return D.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!D.entityKey},u1=function(D){return D.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!D.entityKey},toJ=function(D){return D.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!D.entityKey},
Hm=function(D,O,h,V,k){k=k===void 0?!1:k;
var C,M,c,S,Y,J;return g.Q(function(q){if(q.D==1)return C=g.Jg(D,O),M=g.Jg(D,"downloadStatusEntity"),g.t(q,la(h,{mode:"readonly",g2:!0},function(u){return g.vs.all([rf(u,C,O),rf(u,M,"downloadStatusEntity")])}),2);
c=q.K;S=c.length?c[0]:void 0;if(!S)return q.v3(0);Y=vBC;if(J=c.length>1?c[1]:void 0){if(J.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!k)return q.return();J.downloadState=V}else J={key:M,downloadState:V};g.Z7(S,Y,J);return g.t(q,la(h,{mode:"readwrite",g2:!0},function(u){return g.vs.all([oN(u,S,O),oN(u,J,"downloadStatusEntity")])}),0)})},ep=function(D,O){return D.actionType===O.actionType&&D.entityKey===O.entityKey},LB=function(D,O){if(D&&D.transferState!=="TRANSFER_STATE_COMPLETE"&&D.transferState!==
"TRANSFER_STATE_FAILED"){var h=g.Yy(D.key).entityId;
Sp({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:h,B8:D,offlineModeType:O})}},Pm=function(D){if(!D||!D.thumbnails)return[];
var O=[];D=g.P(D.thumbnails);for(var h=D.next();!h.done;h=D.next())h=h.value,h.url&&O.push(h.url);return O},QH8=function(D,O,h){h=h===void 0?[]:h;
var V,k,C,M,c,S,Y,J,q,u,H,m,R;return g.Q(function(f){if(f.D==1)return h.length?g.t(f,IN(D,O),2):f.return([]);V=f.K;k=new Set;C=g.P(V);for(M=C.next();!M.done;M=C.next())if(c=M.value,S=c.id||c.key)Y=g.Yy(S).entityId,k.add(Y);J=[];q=g.P(h);for(u=q.next();!u.done;u=q.next())H=u.value,m=H.offlineVideoData,R=void 0,((R=m)==null?0:R.videoId)&&!k.has(m.videoId)&&J.push(H);return f.return(J)})},wte=function(D,O,h){return new g.yg(D,{cotn:O,
raw_player_response:h,download_media:!0,start:Infinity,disable_watch_next:!0})},sH8=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},gs=function(D,O,h,V,k,C,M,c,S,Y,J){this.entityType=D;
this.actionId=O;this.action=h;this.parentActionId=V;this.rootActionId=k===void 0?O:k;this.childActionIds=C;this.prereqActionId=M;this.postreqActionIds=c;this.hasChildActionFailed=Y;this.retryScheduleIndex=0;this.D=J||Date.now();this.retryScheduleIndex=S||0},RA=function(D){if(!D.key)throw Error("Entity key is required.");
if(!D.actionProto)throw Error("OfflineOrchestrationAction is required.");var O=g.Yy(D.key),h=g.Yy(D.actionProto.entityKey);return new gs(h.entityType,O.entityId,D.actionProto,D.parentActionId,D.rootActionId,D.childActionIds,D.prereqActionId,D.postreqActionIds,D.retryScheduleIndex,D.hasChildActionFailed,Number(D.enqueueTimeSec)*1E3)},aA=function(D){return{key:g.Jg(D.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:D.action,parentActionId:D.parentActionId,rootActionId:D.rootActionId,childActionIds:D.childActionIds,prereqActionId:D.prereqActionId,postreqActionIds:D.postreqActionIds,retryScheduleIndex:D.retryScheduleIndex,hasChildActionFailed:D.hasChildActionFailed,enqueueTimeSec:(D.D/1E3).toFixed()}},WnS=function(){var D;
return g.Q(function(O){return O.D==1?g.t(O,gBU(),2):(D=O.K)?O.return(D.delete("yt-player-local-img")):O.return(!0)})},fB=function(D){var O,h;
return g.Q(function(V){if(V.D==1)return g.t(V,gBU(),2);if(V.D!=3){O=V.K;if(!O)throw Error("Cache API not supported");return D.length?g.t(V,O.open("yt-player-local-img"),3):V.return()}h=V.K;return g.t(V,Promise.all(D.map(function(k){return h.delete(k)})),0)})},KB=function(D){var O,h;
return g.Q(function(V){if(V.D==1)return g.t(V,gBU(),2);if(V.D!=3){O=V.K;if(!O)throw Error("Cache API not supported");return D.length?g.t(V,O.open("yt-player-local-img"),3):V.return()}h=V.K;return g.t(V,h.addAll(D),0)})},Ex=function(D,O,h,V,k){var C,M,c,S,Y,J,q,u,H,m,R,f,E,A,v,W,z,X,Z,hd,Yw,B,r,I,L,p,Id,aL,hx,Ad,OS;
return g.Q(function(eR){switch(eR.D){case 1:return C=g.Jg(D,"mainVideoEntity"),M=g.Jg(D,"ytMainChannelEntity"),c=g.Jg(D,"transfer"),S=g.Jg(D,"videoDownloadContextEntity"),g.t(eR,la(O,{mode:"readonly",g2:!0},function(lW){return g.vs.all([rf(lW,C,"mainVideoEntity"),rf(lW,M,"ytMainChannelEntity"),rf(lW,c,"transfer"),rf(lW,S,"videoDownloadContextEntity"),pC(lW,"ytMainChannelEntity"),pC(lW,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:Y=eR.K;J=g.P(Y);q=J.next().value;u=J.next().value;H=J.next().value;m=J.next().value;R=J.next().value;f=J.next().value;E=q;A=u;v=H;W=m;z=R;X=f;if(!E&&!A){eR.v3(3);break}Z=E?Pm(E.thumbnail):[];if(!A){hd=[];eR.v3(4);break}return g.t(eR,TJe(A,z),5);case 5:hd=eR.K;case 4:return Yw=hd,g.t(eR,fB(Z.concat(Yw)),3);case 3:B=[];r=g.Jg(D,"downloadStatusEntity");I=g.P(X);for(L=I.next();!L.done;L=I.next())p=L.value,Id=g.Yy(p.key).entityId,aL=RA(p),hx=g.Yy(aL.action.entityKey).entityId,Id!==D&&hx!==D||ep(h,
p.actionProto)||B.push(p.key);return g.t(eR,la(O,{mode:"readwrite",g2:!0},function(lW){var K=B.map(function(U){return ZM(lW,U)});
K.push(ZM(lW,C,{XW:!0}));K.push(ZM(lW,r,{XW:!0}));return g.vs.all(K)}),7);
case 7:OS=(Ad=W)==null?void 0:Ad.offlineModeType,k&&(cm(k),k.offlineModeType&&(OS=k.offlineModeType)),LB(v,OS),ML(V,{entityKey:C,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.LT(eR)}})},nBL=function(D,O,h,V){var k,C,M,c,S,Y,J,q,u,H,m,R,f,E,A,v,W,z,X,Z,hd,Yw,B,r,I,L,p,Id,aL,hx,Ad,OS,eR,lW,K,U,G,w,d,Dy,MP,kw,T,Jd,Pq,bW,Wq,b_,yc,un;
return g.Q(function(NP){switch(NP.D){case 1:return k=g.Jg(D,"mainPlaylistEntity"),C=g.Jg(D,"ytMainChannelEntity"),g.t(NP,la(O,{mode:"readonly",g2:!0},function(zV){return g.vs.all([rf(zV,k,"mainPlaylistEntity"),rf(zV,C,"ytMainChannelEntity"),pC(zV,"mainPlaylistEntity"),pC(zV,"mainDownloadsListEntity"),pC(zV,"ytMainChannelEntity"),pC(zV,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:M=NP.K;c=g.P(M);S=c.next().value;Y=c.next().value;J=c.next().value;q=c.next().value;u=c.next().value;H=c.next().value;m=S;R=Y;f=J;E=q;A=u;v=H;if(!m&&!R){NP.v3(3);break}W=m?d0e(m):[];if(!R){z=[];NP.v3(4);break}return g.t(NP,TJe(R,A),5);case 5:z=NP.K;case 4:return X=z,g.t(NP,fB(W.concat(X)),3);case 3:Z=[];hd=new Map;if(!m){NP.v3(7);break}return g.t(NP,zlU(m,f,E),8);case 8:Z=NP.K;Yw=g.P(Z);for(B=Yw.next();!B.done;B=Yw.next())r=B.value,hd.set(r,{videoId:r,playlistId:D,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.t(NP,la(O,{mode:"readonly",g2:!0},function(zV){return g.vs.all([pC(zV,"transfer"),pC(zV,"videoDownloadContextEntity")])}),9);
case 9:I=NP.K;L=g.P(I);p=L.next().value;Id=L.next().value;aL=p;hx=Id;Ad=g.P(aL);for(OS=Ad.next();!OS.done;OS=Ad.next())eR=OS.value,lW=g.Yy(eR.key).entityId,(K=hd.get(lW))&&eR&&(K.cotn=eR.cotn);U=g.P(hx);for(G=U.next();!G.done;G=U.next())w=G.value,d=g.Yy(w.key).entityId,(Dy=hd.get(d))&&w&&(Dy.offlineModeType=w.offlineModeType);case 7:MP=[];kw=g.P(v);for(T=kw.next();!T.done;T=kw.next())Jd=T.value,Pq=g.Yy(Jd.key).entityId,bW=RA(Jd),Pq!==D&&bW.rootActionId!==D||ep(h,Jd.actionProto)||MP.push(Jd.key);Wq=
g.Jg(D,"mainPlaylistEntity");return g.t(NP,la(O,{mode:"readwrite",g2:!0},function(zV){var JF=MP.map(function(nb){return ZM(zV,nb)});
JF.push(ZM(zV,Wq,{XW:!0}));return g.vs.all(JF)}),10);
case 10:if(!m){NP.v3(0);break}Z.reverse();if(!Z){NP.v3(0);break}b_=g.P(Z);yc=b_.next();case 13:if(yc.done){NP.v3(0);break}un=yc.value;return g.t(NP,Ex(un,O,h,V,hd.get(un)),14);case 14:yc=b_.next(),NP.v3(13)}})},yux=function(D,O,h,V){var k,C,M,c,S,Y,J,q,u;
return g.Q(function(H){if(H.D==1)return k=g.Jg("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),C=new Map,g.t(H,la(D,{mode:"readwrite",g2:!0},function(m){var R=pC(m,"transfer"),f=pC(m,"offlineOrchestrationActionWrapperEntity"),E=pC(m,"videoDownloadContextEntity"),A=rf(m,k,"mainDownloadsListEntity");return g.vs.all([R,f,E,A]).then(function(v){v=g.P(v);var W=v.next().value;var z=v.next().value;var X=v.next().value;var Z=v.next().value;v=FnJ.map(function(Yw){return d28(m,Yw)});
z=g.P(z);for(var hd=z.next();!hd.done;hd=z.next())hd=hd.value,ep(O,hd.actionProto)||v.push(ZM(m,hd.key,{XW:!0}));Z&&(Z.downloads=[],v.push(oN(m,Z,"mainDownloadsListEntity")));if(X)for(X=g.P(X),Z=X.next();!Z.done;Z=X.next())Z=Z.value,z=g.Yy(Z.key).entityId,z=g.Jg(z,"transfer"),C.set(z,Z.offlineModeType);return g.vs.all(v).then(function(){return W})})}),2);
M=H.K;c=g.P(M);for(S=c.next();!S.done;S=c.next())Y=S.value,LB(Y,C.get(Y.key)),J=g.Yy(Y.key).entityId,q={videoId:J,offlineDeleteReason:V,cotn:Y.cotn,offlineModeType:C.get(Y.key)},cm(q),u=g.Jg(J,"mainVideoEntity"),ML(h,{entityKey:u,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.t(H,WnS(),0)})},d0e=function(D,O){var h=[];
if(D.thumbnailStyleData){D=g.P(D.thumbnailStyleData);for(var V=D.next();!V.done;V=D.next()){var k=void 0,C=void 0,M=void 0;h=h.concat(Pm((k=V.value)==null?void 0:(C=k.value)==null?void 0:(M=C.collageThumbnail)==null?void 0:M.coverThumbnail))}}O=Pm(O);return h.concat(O)},zlU=function(D,O,h){var V,k,C,M,c,S,Y,J,q,u,H,m,R,f,E,A,v,W,z,X,Z,hd,Yw;
return g.Q(function(B){V=[];k=new Set;if(h.length)for(C=g.P(h),M=C.next();!M.done;M=C.next())if(c=M.value,S=void 0,(S=c.downloads)==null?0:S.length)for(Y=g.P(c.downloads),J=Y.next();!J.done;J=Y.next())q=J.value,q.videoItem&&(u=g.Yy(q.videoItem).entityId,k.add(u));if(D.videos){H=g.P(D.videos);for(m=H.next();!m.done;m=H.next())R=m.value,f=JSON.parse(g.Yy(R).entityId),f.videoId&&!k.has(f.videoId)&&V.push(f.videoId);E=g.P(O);for(A=E.next();!A.done;A=E.next())if(v=A.value,v.key!==D.key&&(W=v.videos))for(z=
g.P(W),X=z.next();!X.done;X=z.next())Z=X.value,hd=JSON.parse(g.Yy(Z).entityId),hd.videoId&&(Yw=V.indexOf(hd.videoId),Yw!==-1&&V.splice(Yw,1))}return B.return(V)})},TJe=function(D,O){var h,V,k,C,M,c,S,Y;
return g.Q(function(J){h=Pm(D.avatar);V=g.P(O);for(k=V.next();!k.done;k=V.next())if(C=k.value,C.id!==D.id)for(M=g.P(Pm(C.avatar)),c=M.next();!c.done;c=M.next())S=c.value,Y=h.indexOf(S),Y!==-1&&h.splice(Y,1);return J.return(h)})},isJ=function(D){var O;
return g.Q(function(h){O=g.y(D.frameworkUpdates,jp);return D.frameworkUpdates&&O?g.t(h,lTc(O),0):h.return()})},ptC=function(D){var O;
if((O=D.onResponseReceivedActions)!=null&&O.length){var h;D=(h=g.y(g.y(D.onResponseReceivedActions[0],ru9),g.Im9))==null?void 0:h.actions;if(D!=null&&D.length)return D}},NJx=function(D){var O,h,V;
return g.Q(function(k){if(k.D==1)return D?g.t(k,$D(D,g.sn,"mainDownloadsListEntity"),2):k.return([]);O=k.K;return((h=O)==null?0:(V=h.downloads)==null?0:V.length)?k.return(O.downloads.map(function(C){var M;return(M=C.videoItem)!=null?M:""})):k.return([])})},ZsU=function(D,O){var h;
return g.Q(function(V){return V.D==1?g.t(V,oBU(D,O),2):(h=V.K)?g.t(V,la(D,{mode:"readwrite",g2:!0},function(k){var C=[oN(k,h.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];h.mainDownloadsListEntity&&C.push(oN(k,h.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.vs.all(C)}),0):V.v3(0)})},oBU=function(D,O){var h,V,k,C,M,c,S,Y,J,q,u,H,m,R,f,E,A,v;
return g.Q(function(W){if(W.D==1)return h=g.Jg("main_downloads_library_id","mainDownloadsLibraryEntity"),V=g.Jg("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.t(W,la(D,{mode:"readonly",g2:!0},function(z){return g.vs.all([rf(z,h,"mainDownloadsLibraryEntity"),rf(z,V,"mainDownloadsListEntity")])}),2);
k=W.K;C=g.P(k);M=C.next().value;c=C.next().value;S=M;Y=c;S||(S={id:h});J=g.P(O);for(q=J.next();!q.done;q=J.next())if(u=q.value,u===g.sn){if(S.smartDownloadsList)return W.return();S.smartDownloadsList=u}else if(H=g.Yy(u).entityType,m={},H==="mainPlaylistEntity"?m.playlistItem=u:H==="mainVideoEntity"&&(m.videoItem=u),!g.sO(m)){R=void 0;if((R=Y)==null?0:R.downloads){f=!1;E=g.P(Y.downloads);for(A=E.next();!A.done;A=E.next())if(v=A.value,v.playlistItem===u||v.videoItem===u){f=!0;break}f||Y.downloads.push(m)}else Y=
{id:V,downloads:[m]};S.downloadsList=V}return W.return({mainDownloadsLibraryEntity:S,mainDownloadsListEntity:Y})})},XtR=function(D,O){var h,V,k,C,M,c,S,Y,J,q,u,H,m,R,f;
return g.Q(function(E){if(E.D==1)return h=g.Jg("main_downloads_library_id","mainDownloadsLibraryEntity"),V=g.Jg("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.t(E,la(D,{mode:"readonly",g2:!0},function(A){return g.vs.all([rf(A,h,"mainDownloadsLibraryEntity"),rf(A,V,"mainDownloadsListEntity"),rf(A,g.sn,"mainDownloadsListEntity")])}),2);
k=E.K;C=g.P(k);M=C.next().value;c=C.next().value;S=C.next().value;Y=M;J=c;q=S;if(!Y)return E.v3(0);if(O===g.sn&&((u=q)==null?0:u.downloads))q.downloads=[];else if((H=J)==null?0:H.downloads)for(m=g.Yy(O).entityType,R=0;R<J.downloads.length;R++)if(f=J.downloads[R],m==="mainVideoEntity"&&f.videoItem===O){J.downloads.splice(R,1);break}else if(m==="mainPlaylistEntity"&&f.playlistItem===O){J.downloads.splice(R,1);break}return g.t(E,la(D,{mode:"readwrite",g2:!0},function(A){var v=[oN(A,Y,"mainDownloadsLibraryEntity")];
J&&v.push(oN(A,J,"mainDownloadsListEntity"));q&&v.push(oN(A,q,"mainDownloadsListEntity"));return g.vs.all(v)}),0)})},Ux=function(D,O){var h,V,k,C,M,c,S,Y,J,q,u;
return g.Q(function(H){if(H.D==1)return h=g.Jg(O,"transfer"),V=g.Jg(O,"videoDownloadContextEntity"),g.t(H,la(D,{mode:"readonly",g2:!0},function(m){return g.vs.all([rf(m,h,"transfer"),rf(m,V,"videoDownloadContextEntity")])}),2);
k=H.K;C=g.P(k);M=C.next().value;c=C.next().value;S=M;Y=c;u={videoId:O,cotn:(J=S)==null?void 0:J.cotn,offlineModeType:(q=Y)==null?void 0:q.offlineModeType};return H.return(u)})},A_=function(D,O,h,V,k){var C,M,c,S,Y,J,q,u,H,m,R,f,E,A,v,W,z,X,Z,hd;
return g.Q(function(Yw){switch(Yw.D){case 1:return C=g.Jg(D,"musicTrack"),M=g.Jg(D,"transfer"),g.t(Yw,la(O,{mode:"readonly",g2:!0},function(B){return g.vs.all([rf(B,C,"musicTrack"),rf(B,M,"transfer"),pC(B,"musicTrack"),pC(B,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:c=Yw.K;S=g.P(c);Y=S.next().value;J=S.next().value;q=S.next().value;u=S.next().value;H=Y;m=J;R=q;f=u;if(!H){Yw.v3(3);break}return g.t(Yw,BJR(H,R),4);case 4:return E=Yw.K,g.t(Yw,fB(E),3);case 3:A=[];v=g.P(f);for(W=v.next();!W.done;W=v.next())z=W.value,X=g.Yy(z.key).entityId,Z=RA(z),hd=g.Yy(Z.action.entityKey).entityId,X!==D&&hd!==D||ep(h,z.actionProto)||A.push(z.key);return g.t(Yw,la(O,{mode:"readwrite",g2:!0},function(B){var r=A.map(function(I){return ZM(B,I)});
r.push(ZM(B,C,{XW:!0}));return g.vs.all(r)}),6);
case 6:LB(m),k&&cm(k),ML(V,{entityKey:C,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.LT(Yw)}})},GQ=function(D,O,h,V,k){var C,M,c,S,Y,J,q,u,H,m,R,f,E,A,v,W,z,X,Z,hd,Yw,B,r,I,L,p,Id,aL,hx,Ad,OS,eR,lW,K,U,G;
return g.Q(function(w){switch(w.D){case 1:return C=g.Jg(D,O),M=g.Jg("music_downloads_library_id","musicDownloadsLibraryEntity"),g.t(w,la(h,{mode:"readonly",g2:!0},function(d){return g.vs.all([rf(d,C,O),rf(d,M,"musicDownloadsLibraryEntity"),pC(d,O),pC(d,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:c=w.K;S=g.P(c);Y=S.next().value;J=S.next().value;q=S.next().value;u=S.next().value;H=Y;m=J;R=q;f=u;if(!H){w.v3(3);break}return g.t(w,BJR(H,R),4);case 4:return E=w.K,g.t(w,fB(E),3);case 3:A=[];v=new Map;if(!H){w.v3(6);break}return g.t(w,loc(H,R,m),7);case 7:A=w.K;W=g.P(A);for(z=W.next();!z.done;z=W.next())X=z.value,Z=g.Yy(X).entityId,v.set(Z,{videoId:Z,playlistId:D,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.t(w,IN(h,"transfer"),8);case 8:for(hd=w.K,Yw=g.P(hd),
B=Yw.next();!B.done;B=Yw.next())r=B.value,I=g.Yy(r.key).entityId,(L=v.get(I))&&r&&(L.cotn=r.cotn);case 6:p=[];Id=g.P(f);for(aL=Id.next();!aL.done;aL=Id.next())hx=aL.value,Ad=g.Yy(hx.key).entityId,OS=RA(hx),Ad!==D&&OS.rootActionId!==D||ep(V,hx.actionProto)||p.push(hx.key);eR=g.Jg(D,O);return g.t(w,la(h,{mode:"readwrite",g2:!0},function(d){var Dy=p.map(function(MP){return ZM(d,MP)});
Dy.push(ZM(d,eR,{XW:!0}));return g.vs.all(Dy)}),9);
case 9:if(!H){w.v3(0);break}A.reverse();if(!A.length){w.v3(0);break}lW=g.P(A);K=lW.next();case 12:if(K.done){w.v3(0);break}U=K.value;G=g.Yy(U).entityId;if(!G){w.v3(13);break}return g.t(w,A_(G,h,V,k,v.get(G)),13);case 13:K=lW.next(),w.v3(12)}})},t_=function(D,O,h){var V,k,C,M,c,S,Y;
return g.Q(function(J){if(J.D==1)return g.t(J,la(D,{mode:"readwrite",g2:!0},function(q){var u=pC(q,"transfer"),H=pC(q,"offlineOrchestrationActionWrapperEntity");return g.vs.all([u,H]).then(function(m){m=g.P(m);var R=m.next().value;var f=m.next().value;m=x0L.map(function(W){return d28(q,W)});
f=g.P(f);for(var E=f.next();!E.done;E=f.next()){E=E.value;var A=g.Yy(E.actionProto.entityKey).entityType==="musicTrack",v=E.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";ep(O,E.actionProto)||A&&(!A||v)||m.push(ZM(q,E.key,{XW:!0}))}return g.vs.all(m).then(function(){return R})})}),2);
V=J.K;k=g.P(V);for(C=k.next();!C.done;C=k.next())M=C.value,LB(M),c=g.Yy(M.key).entityId,S={videoId:c,offlineDeleteReason:void 0,cotn:M.cotn},cm(S),Y=g.Jg(c,"musicTrack"),ML(h,{entityKey:Y,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.t(J,WnS(),0)})},$0e=function(D){for(var O,h=g.P(D.additionalMetadatas),V=h.next();!V.done;V=h.next())V=V.value,V.offlineMusicVideoData&&(O=V.offlineMusicVideoData);
var k,C,M,c,S;return{id:g.Jg(D.videoId,"musicTrack"),videoId:D.videoId,title:D.title,thumbnailDetails:D.thumbnail,lengthMs:String(Number(D.lengthSeconds)*1E3),albumTitle:(k=O)==null?void 0:k.releaseTitle,musicVideoType:(C=O)==null?void 0:C.musicVideoType,contentRating:{explicitType:(M=O)==null?void 0:M.explicitType},artistNames:((c=O)==null?void 0:c.byline)||((S=O)==null?void 0:S.channelName),downloadMetadata:g.Jg(D.videoId,"musicTrackDownloadMetadataEntity")}},loc=function(D,O,h){var V,k,C,M,c,S,
Y,J,q,u,H,m,R,f,E,A,v,W;
return g.Q(function(z){V=[];k=new Set;if((C=h)==null?0:(M=C.downloadedTracks)==null?0:M.length)for(c=g.P(h.downloadedTracks),S=c.next();!S.done;S=c.next())Y=S.value,k.add(Y);if(D.tracks){J=g.P(D.tracks);for(q=J.next();!q.done;q=J.next())u=q.value,k.has(u)||V.push(u);H=g.P(O);for(m=H.next();!m.done;m=H.next())if(R=m.value,R.id!==D.id&&(f=R.tracks))for(E=g.P(f),A=E.next();!A.done;A=E.next())v=A.value,W=V.indexOf(v),W!==-1&&V.splice(W,1)}return z.return(V)})},BJR=function(D,O){var h,V,k,C,M,c,S,Y;
return g.Q(function(J){h=Pm(D.thumbnailDetails);V=g.P(O);for(k=V.next();!k.done;k=V.next())if(C=k.value,C.id!==D.id)for(M=g.P(Pm(C.thumbnailDetails)),c=M.next();!c.done;c=M.next())S=c.value,Y=h.indexOf(S),Y!==-1&&h.splice(Y,1);return J.return(h)})},Ioe=function(D,O){var h,V,k,C,M,c,S,Y,J;
return g.Q(function(q){if(q.D==1)return h=g.Jg("music_downloads_library_id","musicDownloadsLibraryEntity"),g.t(q,$D(D,h,"musicDownloadsLibraryEntity"),2);(V=q.K)||(V={id:h});k=g.Yy(O).entityType;k==="musicTrack"?(C=V.downloadedTracks)!=null&&C.includes(O)||(V.downloadedTracks=((M=V.downloadedTracks)!=null?M:[]).concat(O)):k==="musicPlaylist"?(c=V.downloadedPlaylists)!=null&&c.includes(O)||(V.downloadedPlaylists=((S=V.downloadedPlaylists)!=null?S:[]).concat(O)):k!=="musicAlbumRelease"||(Y=V.downloadedAlbumReleases)!=
null&&Y.includes(O)||(V.downloadedAlbumReleases=((J=V.downloadedAlbumReleases)!=null?J:[]).concat(O));return g.t(q,xD(D,V,"musicDownloadsLibraryEntity"),0)})},DwR=function(D,O){var h,V,k,C,M,c,S;
return g.Q(function(Y){if(Y.D==1)return h=g.Jg("music_downloads_library_id","musicDownloadsLibraryEntity"),g.t(Y,$D(D,h,"musicDownloadsLibraryEntity"),2);V=Y.K;if(!V)return Y.v3(0);k=g.Yy(O).entityType;k==="musicTrack"?C=V.downloadedTracks:k==="musicPlaylist"&&(C=V.downloadedPlaylists);if((M=C)==null?0:M.length)for(c=0;c<C.length;c++)if(S=C[c],S===O){C.splice(c,1);break}return g.t(Y,xD(D,V,"musicDownloadsLibraryEntity"),0)})},OSS=function(D){var O=D.videos;
D=[];var h=[];if(O){O=g.P(O);for(var V=O.next();!V.done;V=O.next()){var k=V.value.offlineVideoData.videoId;V=g.Jg(k,"musicTrack");k=g.Jg(k,"musicTrackDownloadMetadataEntity");D.push(V);h.push(k)}}return{Vx:D,G1:h}},vm=function(D,O,h){O={track:$0e(O)};
h&&(O.playlistId=h);if(D=g.y(D.actionMetadata,hJR))O.maximumDownloadQuality=D.maximumDownloadQuality;return{musicTrackEntityActionMetadata:O}},kx8=function(D){var O,h,V,k,C,M,c,S;
return g.Q(function(Y){switch(Y.D){case 1:return O=g.gG(),h=kO9(D),V=g.jO(VCC),g.g2(Y,2),C={kC:!0},g.t(Y,g.cD(O,h,V,void 0,C),4);case 4:k=Y.K;g.ad(Y,3);break;case 2:M=g.fT(Y);if(M instanceof g.e7)throw c="GetOffline network manager error: "+M.message,ku(c,M),Error(c);ku("GetOffline fetch request error",M);throw Error("GetOffline fetch request error");case 3:S=Qh(k);if(!k)throw ku("Network request failed"),Error("Network request failed");if(S!==void 0)ws(S);else if(!k.videos||!k.videos.length)throw ku("No data"),
Error("No data");return Y.return(k.videos.map(function(J){return J.offlineVideoData}))}})},Ctc=function(D){var O,h,V,k,C,M,c,S;
return g.Q(function(Y){switch(Y.D){case 1:return O=g.gG(),h=C$S(D),V=g.jO(VCC),g.g2(Y,2),C={kC:!0},g.t(Y,g.cD(O,h,V,void 0,C),4);case 4:k=Y.K;g.ad(Y,3);break;case 2:M=g.fT(Y);if(M instanceof g.e7)throw c="GetOffline network manager error for playlist: "+M.message,ku(c,M),Error(c);ku("GetOffline fetch request error for playlist",M);throw Error("GetOffline fetch request error for playlist");case 3:S=Qh(k);if(!k)throw ku("Network request failed for playlist"),Error("Network request failed for playlist");
if(S!==void 0)ws(S,"playlist");else if(!k.playlists||!k.playlists.length)throw ku("No data for playlist"),Error("No data for playlist");return Y.return(k.playlists.map(function(J){return J.offlinePlaylistData}))}})},bSv=function(D,O,h,V){var k,C,M,c,S,Y,J,q,u,H,m,R,f,E,A,v,W,z,X,Z,hd,Yw,B,r,I,L,p,Id,aL,hx;
return g.Q(function(Ad){switch(Ad.D){case 1:return g.t(Ad,Da(),2);case 2:k=Ad.K;if(!k)return Ad.return([]);C=[];if((M=V)==null?0:M.length){C=V;Ad.v3(3);break}return g.t(Ad,IN(k,"mainPlaylistEntity"),4);case 4:C=Ad.K;case 3:if(!C.length)return Ad.return([]);c=[];S=Date.now()/1E3;Y=g.P(C);J=Y.next();case 5:if(J.done)return c.length?g.t(Ad,MCe(c),10):Ad.return([]);q=J.value;if(!q.downloadState){u=void 0;Ad.v3(8);break}return g.t(Ad,$D(k,q.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:u=
Ad.K;case 8:H=u;m=void 0;f=(R=(m=q)==null?void 0:m.entityMetadata)&&R.nextAutoRefreshIntervalSeconds?Number(R.nextAutoRefreshIntervalSeconds):NaN;E=Number.isNaN(f)?D:f;v=A=void 0;W=((A=H)==null?0:A.lastSyncedTimestampMillis)?Number((v=H)==null?void 0:v.lastSyncedTimestampMillis)/1E3:0;X=z=void 0;Z=((z=H)==null?0:z.addedTimestampMillis)?Number((X=H)==null?void 0:X.addedTimestampMillis)/1E3:0;if(h||!R||W+E<=S){hd=[];Yw=void 0;if((Yw=q.videos)==null?0:Yw.length)for(B=g.P(q.videos),r=B.next();!r.done;r=
B.next())I=r.value,L=JSON.parse(g.Yy(I).entityId),L.videoId&&hd.push(L.videoId);p="0";R&&(Id=void 0,p=String(Number((Id=R.offlineLastModifiedTimestampSeconds)!=null?Id:0).toFixed()));aL={playlistId:q.playlistId,videoIds:hd,offlineLastModifiedTimestamp:p,autoSync:O,offlineDateAddedTimestamp:String(Z.toFixed())};c.push(aL)}J=Y.next();Ad.v3(5);break;case 10:return hx=Ad.K,Ad.return(hx)}})},cr8=function(){var D,O,h,V,k;
return g.Q(function(C){if(C.D==1)return g.t(C,Da(),2);if(C.D!=3)return(D=C.K)?g.t(C,IN(D,"refresh"),3):C.return(!1);O=C.K;if((h=O[0])==null||!h.refreshTime)return C.return(!1);V=Number(O[0].refreshTime);k=Date.now()/1E3;return C.return(isFinite(V)&&k>=V)})},Yic=function(D,O){var h,V,k;
return g.Q(function(C){switch(C.D){case 1:return g.g2(C,2),g.t(C,Si8(D,O),4);case 4:return V=C.K,g.t(C,isJ(V),5);case 5:h=ptC(V);g.ad(C,3);break;case 2:k=g.fT(C),ku("getAndProcessSmartDownloadsResponse request or processing error",k);case 3:return C.return(h)}})},JrS=function(D,O,h,V){var k,C,M,c,S,Y,J,q,u,H,m,R,f,E,A,v,W,z,X,Z,hd,Yw,B,r,I,L,p,Id,aL,hx;
return g.Q(function(Ad){switch(Ad.D){case 1:return g.t(Ad,Da(),2);case 2:k=Ad.K;if(!k)return Ad.return([]);C=[];if((M=V)==null?0:M.length){C=V;Ad.v3(3);break}return g.t(Ad,IN(k,"musicPlaylist"),4);case 4:C=Ad.K;case 3:if(!C.length)return Ad.return([]);c=[];S=Date.now()/1E3;Y=g.P(C);J=Y.next();case 5:if(J.done)return c.length?g.t(Ad,MCe(c),10):Ad.return([]);q=J.value;u=void 0;m=(H=(u=q)==null?void 0:u.entityMetadata)&&H.nextAutoRefreshIntervalSeconds?Number(H.nextAutoRefreshIntervalSeconds):NaN;R=
Number.isNaN(m)?D:m;E=f=0;A="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!q.downloadMetadata){Ad.v3(8);break}return g.t(Ad,$D(k,q.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:v=Ad.K,z=W=void 0,f=Number((z=(W=v)==null?void 0:W.addedTimestampMillis)!=null?z:"0")/1E3,Z=X=void 0,E=Number((Z=(X=v)==null?void 0:X.lastModifiedTimestampMillis)!=null?Z:"0")/1E3,Yw=hd=void 0,A=(Yw=(hd=v)==null?void 0:hd.syncState)!=null?Yw:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:B=void 0;if(h||A!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!H||Number((B=H.lastSyncedTimestampSeconds)!=null?B:0)+R<=S){r=[];I=void 0;if((I=q.tracks)==null?0:I.length)for(L=g.P(q.tracks),p=L.next();!p.done;p=L.next())Id=p.value,r.push(g.Yy(Id).entityId);aL={playlistId:q.playlistId,videoIds:r,offlineLastModifiedTimestamp:String(E.toFixed()),autoSync:O,offlineDateAddedTimestamp:String(f.toFixed())};c.push(aL)}J=Y.next();Ad.v3(5);break;case 10:return hx=Ad.K,Ad.return(hx)}})},Si8=function(D,O){var h,V,k,C,M,c,S,Y,J,q;
return g.Q(function(u){switch(u.D){case 1:return h=g.gG(),g.t(u,Da(),2);case 2:V=u.K;if(!V){u.v3(3);break}return g.t(u,qyc(V),4);case 4:k=u.K;case 3:var H=k;C={context:g.f_(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:D},offlineClientState:H,clientStateRequestData:{preferredFormatType:O}}}};M=g.jO(qi_);g.g2(u,5);S={kC:!0};return g.t(u,g.cD(h,C,M,void 0,S),7);case 7:c=u.K;g.ad(u,6);break;case 5:Y=g.fT(u);if(Y instanceof g.e7)throw J=
"DPS network manager error for smart downloads: "+Y.message,ku(J,Y),Error(J);ku("DPS fetch request error for smart downloads",Y);throw Error("DPS fetch request error for smart downloads");case 6:q=Qh(c);if(c)q!==void 0&&ws(q,"smart downloads");else throw ku("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return u.return(c)}})},HSL=function(D,O){var h,V,k,C,M,c,S,Y;
return g.Q(function(J){switch(J.D){case 1:return h=g.gG(),V={context:g.f_(),videoPlaybackPositionEntities:D,lastSyncTimestampUsec:O},k=g.jO(usv),g.g2(J,2),M={kC:!0},g.t(J,g.cD(h,V,k,void 0,M),4);case 4:C=J.K;g.ad(J,3);break;case 2:c=g.fT(J);if(c instanceof g.e7)throw S="VPPS network manager error: "+c.message,ku(S,c),Error(S);ku("VPPS fetch request error",c);throw Error("VPPS fetch request error");case 3:Y=Qh(C);if(C)Y!==void 0&&ws(Y,"position sync");else throw ku("Network request failed for position sync"),
Error("Network request failed for position sync");return J.return(C)}})},eJ8=function(D,O,h){var V,k,C,M,c,S,Y,J;
return g.Q(function(q){switch(q.D){case 1:V=g.gG();var u=h.refreshData,H=h.isEnqueuedForExpiredStreamUrlRefetch,m=h.Xw,R=h.offlineSourceData,f=h.mediaCapabilities,E={entityKey:D};u&&(E.refreshData=u);H&&(E.isExpiredStreamUrlRefetch=H);m&&(E.downloadParameters=m);R&&(E.offlineSourceData=R);u={context:g.PR(O),signatureTimestamp:20102,videos:[E]};f&&(u.mediaCapabilities=f);k=u;C=g.jO(mwU);g.g2(q,2);c={kC:!0};return g.t(q,g.cD(V,k,C,void 0,c),4);case 4:M=q.K;g.ad(q,3);break;case 2:S=g.fT(q);if(S instanceof
g.e7)throw Y="GetPDE network manager error: "+S.message,ku(Y,S),Error(Y);ku("GetPDE fetch request error",S);throw Error("GetPDE fetch request error");case 3:J=Qh(M);if(M)J!==void 0&&ws(J,"PDE");else throw ku("Network request failed for PDE"),Error("Network request failed for PDE");return q.return(M)}})},Qh=function(D){var O;
return(O=D.errorMetadata)==null?void 0:O.status},ws=function(D,O){O=O?" for "+O:"";
if(D===0)throw D="Empty response body"+O,ku(D),Error(D);D="Response with error"+O;ku(D);throw Error(D);},MCe=function(D){var O,h,V,k,C,M,c,S;
return g.Q(function(Y){switch(Y.D){case 1:return O=g.gG(),h=Mo0(D),V=g.jO(L9_),g.g2(Y,2),C={kC:!0},g.t(Y,g.cD(O,h,V,void 0,C),4);case 4:k=Y.K;g.ad(Y,3);break;case 2:M=g.fT(Y);if(M instanceof g.e7)throw c="offlinePlaylistSyncCheck network manager error: "+M.message,ku(c,M),Error(c);ku("offlinePlaylistSyncCheck fetch request error",M);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:S=Qh(k);if(!k)throw ku("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(S!==void 0)ws(S,"playlist sync");else if(!k.offlinePlaylistSyncCheckDatas||!k.offlinePlaylistSyncCheckDatas.length)throw ku("No data for playlist sync"),Error("No data for playlist sync");return Y.return(k.offlinePlaylistSyncCheckDatas.map(function(J){return J.offlinePlaylistSyncCheckData}))}})},sx=function(D){this.D=D},Ptv=function(D,O){var h,V,k,C,M,c;
return g.Q(function(S){switch(S.D){case 1:h=new Map,V=g.P(O),k=V.next();case 2:if(k.done){S.v3(4);break}C=k.value;M=h;c=M.set;return g.t(S,D.K(C),5);case 5:c.call(M,C,S.K);k=V.next();S.v3(2);break;case 4:return S.return(h)}})},Wm=function(D,O,h,V,k,C){O=g.Jg(O,h);
V=Object.assign({},C,{priority:V,retryScheduleIntervalsInSeconds:k});return{actionType:D,entityKey:O,actionMetadata:V}},TQ=function(D,O,h,V,k,C){this.status=D;
this.D=O;this.W=h;this.K=V;this.j=k;this.downloadState=C},gM_=function(D,O,h){this.D=D;
this.D8=O;this.j=h},fBR=function(D,O){var h,V,k,C,M,c,S,Y,J;
return g.Q(function(q){switch(q.D){case 1:return h=O.entityKey,k=(V=g.y(O.actionMetadata,ds))==null?void 0:V.isEnqueuedForExpiredStreamUrlRefetch,g.g2(q,2),C=void 0,g.t(q,RJL(D,O),4);case 4:C=q.K;g.g2(q,5);var u=(u=g.y(O.actionMetadata,ds))?{maximumDownloadQuality:u.maximumDownloadQuality}:void 0;return g.t(q,eJ8(h,D.D8,{isEnqueuedForExpiredStreamUrlRefetch:k,Xw:u,offlineSourceData:C}),7);case 7:M=q.K;g.ad(q,6,2);break;case 5:return g.fT(q,2),c=Yu(O)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",ku("PDE handleAdd error"),q.return(zQ(O,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",c,"DOWNLOAD_STATE_FAILED"));case 6:return g.t(q,aBv(D,M,O),8);case 8:return q.return(zQ(O,!0,M.orchestrationActions));case 2:return S=g.fT(q),Y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",S instanceof g.KQ&&S.type==="QUOTA_EXCEEDED"&&(Y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
J="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),ku("PDE handleAdd error"),q.return(zQ(O,!1,void 0,Y,J,"DOWNLOAD_STATE_FAILED"))}})},juv=function(D,O){var h,V,k,C,M,c,S,Y,J,q,u,H,m,R,f,E,A,v,W,z,X,Z,hd,Yw;
return g.Q(function(B){switch(B.D){case 1:return h=O.entityKey,V=g.Yy(h).entityId,g.t(B,la(D.D,{mode:"readonly",g2:!0},function(r){var I=rf(r,h,"playbackData"),L=rf(r,g.Jg(V,"offlineVideoPolicy"),"offlineVideoPolicy");r=rf(r,g.Jg(V,"transfer"),"transfer");return g.vs.all([I,L,r])}),2);
case 2:k=B.K;C=g.P(k);M=C.next().value;c=C.next().value;S=C.next().value;Y=M;J=c;q=S;if(!Y||!J)return B.return(zQ(O,!0));u=[];R=((m=Y)==null?0:m.playerResponseJson)?JSON.parse(Y.playerResponseJson):null;if(!(q&&R&&D.D8.S("html5_refresh_deprecated_downloads"))){B.v3(3);break}H=K9U(D,R,q);return g.t(B,EM0(D,q),4);case 4:u=B.K;case 3:f={lastPlayerResponseTimestampSeconds:Y.playerResponseTimestamp,offlineToken:J.offlineToken,formatIds:u};E={};if((A=q)==null?0:A.maximumDownloadQuality)E.maximumDownloadQuality=
q.maximumDownloadQuality;g.g2(B,5);v=void 0;return g.t(B,RJL(D,O),7);case 7:return v=B.K,g.g2(B,8),g.t(B,eJ8(h,D.D8,{refreshData:f,Xw:E,offlineSourceData:v,mediaCapabilities:H}),10);case 10:W=B.K;g.ad(B,9,5);break;case 8:return g.fT(B,5),z=Yu(O)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",ku("PDE handleRefresh error"),B.return(zQ(O,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",z,"DOWNLOAD_STATE_FAILED"));
case 9:return g.t(B,aBv(D,W,O),11);case 11:return B.return(zQ(O,!0,W.orchestrationActions));case 5:return X=g.fT(B),Z="PDE handleRefresh error",X instanceof Error&&(Z="PDE handleRefresh error: "+X.message),hd="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Yw="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.KQ&&X.type==="QUOTA_EXCEEDED"&&(hd="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Yw="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),ku(Z),B.return(zQ(O,
!1,void 0,hd,Yw,"DOWNLOAD_STATE_FAILED"))}})},RJL=function(D,O){var h,V,k,C;
return g.Q(function(M){if(M.D==1)return h=g.Yy(O.entityKey).entityId,V=g.Jg(h,"videoDownloadContextEntity"),g.t(M,$D(D.D,V,"videoDownloadContextEntity"),2);k=M.K;return(C=k)!=null&&C.offlineModeType?M.return({offlineModeType:k.offlineModeType}):M.return(void 0)})},aBv=function(D,O,h){var V,k,C,M,c;
return g.Q(function(S){if(S.D==1){if(!O.frameworkUpdates||!g.y(O.frameworkUpdates,jp))return S.return();if(!(g.y(O.frameworkUpdates,jp).mutations&&g.y(O.frameworkUpdates,jp).mutations.length>0&&g.y(O.frameworkUpdates,jp).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return S.v3(2);V=g.Yy(g.y(O.frameworkUpdates,jp).mutations[0].entityKey).entityId;return g.t(S,Ux(D.D,V),3)}if(S.D!=2){k=S.K;C=g.y(h.actionMetadata,ds);if(c=(M=C)==null?void 0:M.playlistId)k.playlistId=c;k.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.Z$(D.D8)?g.t(S,Ex(V,D.D,h,D.j,k),2):g.pP(D.D8)?g.t(S,A_(V,D.D,h,D.j),2):S.v3(2)}return g.t(S,lTc(g.y(O.frameworkUpdates,jp)),0)})},zQ=function(D,O,h,V,k,C){return new TQ(O?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Yu(D),h,V,k,C)},K9U=function(D,O,h){O=wte(D.D8,h.cotn,O);
h=g.uK(O);return g.Z8y(O,h,D.D8)},EM0=function(D,O){var h,V,k,C,M,c,S,Y,J,q,u;
return g.Q(function(H){if(H.D==1)return h=[],g.t(H,la(D.D,{mode:"readonly",g2:!0},function(m){var R=[],f=O.offlineVideoStreams;if(f){f=g.P(f);for(var E=f.next();!E.done;E=f.next())R.push(rf(m,E.value,"offlineVideoStreams"))}return g.vs.all(R)}),2);
if(V=H.K)for(k=g.P(V),C=k.next();!C.done;C=k.next())if(M=C.value,c=void 0,(c=M)==null?0:c.streamsProgress)for(S=M.streamsProgress,Y=0;Y<S.length;Y++)J=S[Y],q=JSON.parse(J.formatStreamBytes),u={itag:q.itag,lmt:q.lastModified,xtags:q.xtags},h.push(u);return H.return(h)})},Uwe=function(D,O){this.D=D;
this.D8=O},Are=function(D,O){var h,V,k,C,M,c,S,Y,J,q,u,H;
return g.Q(function(m){switch(m.D){case 1:return h=Yu(O),g.t(m,IN(D.D,"videoPlaybackPositionEntity"),2);case 2:V=m.K;if(V.length===0)return m.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));g.g2(m,3);return g.t(m,FV.getInstance(),5);case 5:k=m.K;if(!k)throw Error("prefStorage is undefined");return g.t(m,k.get("psi"),6);case 6:return C=m.K,S=(c=(M=C)==null?void 0:M.aB)!=null?c:"0",g.t(m,HSL(V,S),7);case 7:return Y=m.K,J={isPaused:Y.watchHistoryPaused,aB:Y.syncTimestampUsec},g.t(m,k.set("psi",
J),8);case 8:if(J.isPaused){m.v3(9);break}q=g.y(Y.frameworkUpdates,jp);if(!Y.frameworkUpdates||!q){m.v3(9);break}return g.t(m,lTc(q),9);case 9:g.ad(m,4);break;case 3:return u=g.fT(m),H="PPE handleRefresh error: "+(u instanceof Error?u.message:"unknown error"),ku(H),m.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return m.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h))}})},tC8=function(D,O){var h,V,k,C,M,c,S,Y;
return g.Q(function(J){switch(J.D){case 1:return h=Yu(O),V=g.Yy(O.entityKey).entityId,g.g2(J,2),g.t(J,FV.getInstance(),4);case 4:k=J.K;if(!k)throw Error("prefStorage is undefined");return g.t(J,k.get("psi"),5);case 5:C=J.K;M=g.y(O.actionMetadata,GxR);if(((c=C)==null?void 0:c.isPaused)!==!1||(S=M)==null||!S.lastPlaybackPositionSeconds){J.v3(6);break}Y={key:g.Jg(V,"videoPlaybackPositionEntity"),videoId:V,lastPlaybackPositionSeconds:M.lastPlaybackPositionSeconds};return g.t(J,xD(D.D,Y,"videoPlaybackPositionEntity"),
6);case 6:g.ad(J,3);break;case 2:return g.fT(J),J.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return J.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h))}})},vMv=function(D,O){var h,V,k;
return g.Q(function(C){switch(C.D){case 1:h=Yu(O);g.g2(C,2);V=g.Yy(O.entityKey).entityId;if(V==="!*$_ALL_ENTITIES_!*$")return g.t(C,N0v(D.D),5);k=g.Jg(V,"videoPlaybackPositionEntity");return g.t(C,pSv(D.D,k),5);case 5:g.ad(C,3);break;case 2:return g.fT(C),C.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return C.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h))}})},Quc=function(D,O){this.api=D;
this.D=O;this.logger=new g.m3("woffle");this.K=!1;this.HF={rh:this.rh};this.logger.debug("Initialized OfflineMediaManager")},wCx=function(D){return g.Q(function(O){return O.return(Vov(D))})},suL=function(D){var O;
return g.Q(function(h){if(h.D==1)return g.t(h,g.IYd(D),2);O=h.K;return h.return(O.filter(function(V){return!!V.url}).map(function(V){return V.url}))})},nB=function(D,O){var h=g.UK(O);
if(h===1||h===0)return Promise.resolve();(h=W9J(D,O))&&h.stopVideo();D.j=0;return wCx(O)},Fc=function(D,O,h,V){h=h===void 0?!1:h;
V=V===void 0?!0:V;var k=typeof O==="string"?O:O.videoDetails.videoId;g.UK(k)===2&&((O=W9J(D,k))?O.stopVideo():D.logger.info(function(){return"Corresponding player for "+k+" not found. Pausing anyway"}),g.A1(k,2),D.j=2,h?TML(D.D):V&&dwR(D.D))},W9J=function(D,O){var h;
return((h=D.player)==null?void 0:h.getVideoData().videoId)===O?D.player:null},zJe=function(D,O,h){O.getPlayerResponse();
g.A1(O.videoId,2);D.j=2;D.K=!1;var V;(V=D.player)==null||V.dispose();D.player=D.api.Oy(9,O);O={};D.player.zc((O.localmediachange=D.Fz,O.signatureexpired=D.YY,O.statechange=D.mvi,O),D);var k=D.rh(h);D.player.vT(g.VM(k,k,!0,"m"),!1);D.logger.debug(function(){return"Starting headless playback with quality: "+k});
D.player.De(!1)},nMS=function(D,O){this.D=D;
this.D8=O},yr8=function(D,O){var h,V;
return g.Q(function(k){switch(k.D){case 1:return h=Yu(O),g.t(k,$D(D.D,O.entityKey,"transfer"),2);case 2:if(V=k.K)return k.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));g.g2(k,3);return g.t(k,F9R(D,O),5);case 5:g.ad(k,4);break;case 3:return g.fT(k),k.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return k.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h))}})},iSx=function(D,O){var h,V;
return g.Q(function(k){switch(k.D){case 1:return h=Yu(O),g.t(k,$D(D.D,O.entityKey,"transfer"),2);case 2:V=k.K;if(!V||V.transferState!=="TRANSFER_STATE_COMPLETE")return k.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));g.g2(k,3);return g.t(k,F9R(D,O,!0),5);case 5:g.ad(k,4);break;case 3:return g.fT(k),k.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return k.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h))}})},rrJ=function(D,O){var h,V,k,C,M,c,S,Y,J,q;
return g.Q(function(u){switch(u.D){case 1:return h=Yu(O),V=g.Yy(O.entityKey).entityId,g.t(u,la(D.D,{mode:"readonly",g2:!0},function(H){var m=rf(H,O.entityKey,"transfer");H=rf(H,g.Jg(V,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.vs.all([m,H])}),2);
case 2:k=u.K;C=g.P(k);M=C.next().value;c=C.next().value;S=M;Y=c;if(!S||S.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return u.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));g.g2(u,3);S.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.t(u,xD(D.D,S,"transfer"),5);case 5:J=g.Yy(S.key).entityId;Sp({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:J,B8:S,offlineModeType:(q=Y)==null?void 0:q.offlineModeType});g.ad(u,
4);break;case 3:return g.fT(u),u.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return u.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h))}})},F9R=function(D,O,h){h=h===void 0?!1:h;
var V,k,C,M,c,S,Y,J,q,u,H,m,R,f,E;return g.Q(function(A){switch(A.D){case 1:return V=g.y(O.actionMetadata,pCe),k=g.Yy(O.entityKey).entityId,C=g.Jg(k,"downloadStatusEntity"),g.t(A,la(D.D,{mode:"readonly",g2:!0},function(v){var W=rf(v,C,"downloadStatusEntity");v=rf(v,g.Jg(k,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.vs.all([W,v])}),2);
case 2:return M=A.K,c=g.P(M),S=c.next().value,Y=c.next().value,J=S,q=Y,u="TRANSFER_STATE_TRANSFER_IN_QUEUE",((H=J)==null?void 0:H.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(u="TRANSFER_STATE_PAUSED_BY_USER"),f={key:O.entityKey,transferState:u,cotn:g.v9(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(m=V)==null?void 0:m.maximumDownloadQuality,preferredAudioTrack:(R=V)==null?void 0:R.preferredAudioTrack,transferRetryCount:0,isRefresh:h,hasLoggedFirstStarted:!1},g.t(A,la(D.D,
{mode:"readwrite",g2:!0},function(v){var W=[];h&&W.push(ZM(v,g.Jg(k,"offlineVideoStreams")));W.push(oN(v,f,"transfer"));return g.vs.all(W)}),3);
case 3:if(!h){A.v3(4);break}return g.t(A,wCx(k),4);case 4:Sp({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:k,B8:f,offlineModeType:(E=q)==null?void 0:E.offlineModeType}),g.LT(A)}})},oM8=function(D,O,h,V){if(!D.action.entityKey)throw Error("entityKey is missing.");
var k=g.Yy(D.action.entityKey);k={entityType:k.yR,entityId:k.entityId,offlineOrchestrationActionType:D.action.actionType,orchestrationAction:{orchestrationActionId:D.actionId}};O&&(k.offlineOrchestrationActionResult=O.status,k.isRetryable=h?!1:O.D,O.j&&(k.offlineOrchestrationFailureReason=NMR(O.j,k.isRetryable)));var C,M;if((C=D.action.actionMetadata)==null?0:(M=C.offlineLoggingData)==null?0:M.offlineModeType)k.offlineModeType=D.action.actionMetadata.offlineLoggingData.offlineModeType;V&&(k.additionalOrchestrationActions=
V.map(function(c){return{orchestrationActionId:c.actionId}}));
return k},NMR=function(D,O){return D!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||O?D==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&O?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":D:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},ZSe=function(D,O){var h={offlineOrchestrationContext:oM8(D)};
O=Yy9(O,h);Ju_(SyU(),O,D.rootActionId)},XCv=function(D,O,h,V){V=V===void 0?[]:V;
O={offlineOrchestrationContext:oM8(D,O,h,V)};O=Yy9(3,O);Ju_(SyU(),O,D.rootActionId)},BMJ=function(){this.actions=[]},lBU=function(D,O){O=g.P(O);
for(var h=O.next();!h.done;h=O.next())h=h.value,ZSe(h,1),D.actions.push(h);D.actions.sort(D.D)},xwC=function(D,O){if(O)for(var h=0;h<D.actions.length;h++)if(O==="!*$_ALL_ENTITIES_!*$"&&D.actions[h].actionId!==O||O!=="!*$_ALL_ENTITIES_!*$"&&D.actions[h].rootActionId===O&&D.actions[h].actionId!==O)D.actions.splice(h,1),h--},$wc=function(D,O){D=g.P(D.actions);
for(var h=D.next();!h.done;h=D.next())if(h.value.actionId===O)return!0;return!1},yh=function(D,O,h,V,k){g.n.call(this);
var C=this;this.K=D;this.lS=O;this.Ew=h;this.L=V;this.D8=k;this.D=new BMJ;this.Z=new g.M7;this.j=new g.kF(function(){C.retry()});
this.T=NaN;this.J=!1;this.HF={e0W:function(){return C.D},
Pb:function(){return C.Z},
sqT:function(){return C.j},
retry:function(){return C.retry()}};
g.F(this,this.j);this.U=this.K.observe(this.jT.bind(this))},O7m=function(D,O,h,V,k){var C;
return g.Q(function(M){if(M.D==1)return C=new yh(D,O,h,V,k),g.t(M,IB9(C),2);DqL(C);return M.return(C)})},DqL=function(D){var O=D.D.actions[0];
return D.W?((O==null?void 0:O.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&D.W[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(D.J=!0),Promise.resolve()):hpv(D)},hpv=function(D){var O,h,V,k,C,M,c,S,Y,J,q,u,H,m,R,f,E;
return g.Q(function(A){switch(A.D){case 1:if(D.W)throw Error("Already processing an action");if(D.Z8())return A.return();O=D.D.actions.shift();EBL(D.Ew,!O);if(O===void 0)return A.return();O.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&O.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&xwC(D.D,O.actionId);h="";O.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&O.rootActionId===O.actionId&&(h=O.actionId);V=[O];D.W=V;if(k=D.lS[O.entityType]){A.v3(2);break}D.W=
void 0;return g.t(A,hpv(D),3);case 3:return A.return();case 2:C=g.P(V);for(M=C.next();!M.done;M=C.next())c=M.value,ZSe(c,2);g.g2(A,4,5);return g.t(A,Ptv(k,V.map(function(v){return v.action})),7);
case 7:S=A.K,Y=g.P(V),J=Y.next();case 8:if(J.done){A.v3(10);break}q=J.value;u=S.get(q.action);return g.t(A,V6U(D,q,u),9);case 9:J=Y.next();A.v3(8);break;case 10:xwC(D.D,h);case 5:g.KT(A);D.W=void 0;g.Ee(A,6);break;case 4:return H=g.fT(A),ku("Orchestration error",H),g.g2(A,12),g.t(A,kbR(D,V),14);case 14:g.ad(A,5);break;case 12:m=g.fT(A);ku("Orchestration retry error",m);R=g.P(V);for(f=R.next();!f.done;f=R.next())E=f.value,E.retryScheduleIndex<3&&lBU(D.D,[E]);A.v3(5);break;case 6:return g.t(A,hpv(D),
0)}})},V6U=function(D,O,h){var V,k,C,M,c,S,Y,J,q,u,H,m;
return g.Q(function(R){switch(R.D){case 1:V=O.retryScheduleIndex+2===3;if(h.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){R.v3(2);break}if(h.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){R.v3(0);break}XCv(O,h,V);if(h.D&&O.retryScheduleIndex+1<3)return g.t(R,kbR(D,[O]),0);C=((k=h)==null?0:k.K)?h.K:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";M={entityKey:O.action.entityKey,failureReason:C};c=void 0;g.Z$(D.D8)?c="mainVideoDownloadStateEntity":g.pP(D.D8)&&(c="musicTrackDownloadMetadataEntity");
if(!c||!h.downloadState){R.v3(7);break}S=g.Yy(O.action.entityKey).entityId;return g.t(R,Hm(S,c,D.K,h.downloadState),7);case 7:ML(D.L,M);if(h.downloadState==="DOWNLOAD_STATE_FAILED"&&D.D8.S("html5_auto_retry_failed_pde_actions")){R.v3(0);break}ku("Orchestration result is not retryable, deleting action");return g.t(R,pSv(D.K,aA(O).key),0);case 2:Y=void 0;try{Y=(J=h.W)==null?void 0:J.map(function(f){return D.createAction(f,O)})}catch(f){return XCv(O,h,V),q={entityKey:O.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},ML(D.L,q),ku("Orchestration subactions creation error",f),R.return()}XCv(O,h,V,Y);if(!Y){R.v3(12);break}u=Y.map(function(f){return aA(f)});
H=0;case 13:if(!(H<Y.length)||D.J){R.v3(15);break}return g.t(R,la(D.K,{mode:"readwrite",g2:!0},function(f){var E=[];E.push(sKx(f,u.slice(H,H+10),"offlineOrchestrationActionWrapperEntity"));return g.vs.all(E)}),16);
case 16:H+=10;R.v3(13);break;case 15:if(D.J)return D.J=!1,R.return();case 12:return m=aA(O),g.t(R,pSv(D.K,m.key),17);case 17:ZSe(O,4),g.LT(R)}})},cB9=function(D,O){var h,V,k,C,M,c,S,Y,J,q,u,H;
return g.Q(function(m){h=[];V=Infinity;k=4E3;C=g.P(O);for(M=C.next();!M.done;M=C.next())c=M.value,S=Number(c.enqueueTimeSec),Y=CjC(S),J=c.retryScheduleIndex,q=J!=null&&J>0,Y>0&&q?(V=Math.min(V,S),k=Math.min(Y,k)):h.push(c);isFinite(V)&&(!D.j.isActive()||V<D.T)&&(D.T=V,D.j.start(k));D.Z.Sf()||(u=h.length,h=h.filter(function(R){var f;R=((f=R.actionProto)==null?void 0:f.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!M6R.includes(R)}),H=h.length<u,!D.j.isActive()&&H&&D.j.start(1));
h.length>0&&b79(D,h);return g.t(m,DqL(D),0)})},YpS=function(D){var O,h,V,k,C,M,c;
return g.Q(function(S){if(S.D==1)return g.t(S,Spc(D),2);O=S.K;h=[];V=g.P(O);for(k=V.next();!k.done;k=V.next())C=k.value,M=g.Yy(C.key),c=M.entityId,$wc(D.D,c)||h.push(C);return g.t(S,cB9(D,h),0)})},CjC=function(D){D=D*1E3-Date.now();
return D>4E3?4E3:D},kbR=function(D,O){var h,V,k;
return g.Q(function(C){h=g.P(O);for(V=h.next();!V.done;V=h.next()){k=V.value;var M=void 0,c=void 0,S=((c=k.action)==null?void 0:(M=c.actionMetadata)==null?void 0:M.retryScheduleIntervalsInSeconds)||[1,2,4];M=1;k.retryScheduleIndex<S.length&&(M=S[k.retryScheduleIndex]);k.D=M*1E3+Date.now();k.retryScheduleIndex++}return g.t(C,JBR(D,O),0)})},IB9=function(D){var O;
return g.Q(function(h){if(h.D==1)return g.t(h,IN(D.K,"offlineOrchestrationActionWrapperEntity"),2);O=h.K;return g.t(h,cB9(D,O),0)})},b79=function(D,O){O.length!==0&&O.forEach(function(h){h=RA(h);
h.retryScheduleIndex<3&&lBU(D.D,[h])})},Spc=function(D,O){var h;
return g.Q(function(V){if(V.D==1)return g.t(V,IN(D.K,"offlineOrchestrationActionWrapperEntity",O),2);h=V.K;return V.return(h.filter(x2S))})},JBR=function(D,O){if(O.length===0)return Promise.resolve([]);
O=O.map(function(h){return aA(h)});
return rwL(D.K,O)},qpL=function(D){this.aW=D;
this.D=void 0},u6v=function(D,O){var h,V,k,C;
return g.Q(function(M){h=O.videoId;V=!0;if(O.captionTracks.length)k=W0m(O),D.D=new g.FU(D.aW,O,k);else if(O.RK)C=g.L7d(O),D.D=new g.i9(D.aW,O.RK,h,C,O.Ki,O.eventId),V=O.Ki;else return M.return();return M.return(new Promise(function(c){var S;(S=D.D)==null||S.aU({Yy:function(){return g.Q(function(Y){if(Y.D==1)return g.t(Y,D.Yy(h,V),2);c();g.LT(Y)})},
bC:function(){}})}))})},H7c=function(D){var O;
return g.Q(function(h){if(h.D==1)return g.t(h,hlx(D),2);O=h.K;return h.return(!!O&&O.length>0)})},i1=function(D){g.n.call(this);
this.D=D;this.K=this.D.observe(this.j.bind(this))},mqC=function(D,O){var h,V,k,C,M,c,S;
return g.Q(function(Y){switch(Y.D){case 1:if(O.length===0)return Y.return([]);h=O.map(function(J){return g.Jg(J,"transfer")});
return g.t(Y,IN(D.D,"transfer",h),2);case 2:V=Y.K;k=V.filter(x2S).map(function(J){return g.Yy(J.key).entityId});
C=O.filter(function(J){return k.indexOf(J)===-1});
if(C.length===0)return Y.return([]);M=g.P(C);c=M.next();case 3:if(c.done){Y.v3(5);break}S=c.value;return g.t(Y,wCx(S),4);case 4:c=M.next();Y.v3(3);break;case 5:return Y.return(C)}})},PjR=function(D,O,h,V,k,C){var M,c,S;
return g.Q(function(Y){M="STREAM_TYPE_UNKNOWN";h.video&&h.audio?(M="STREAM_TYPE_AUDIO_AND_VIDEO",ku("unexpected stream type")):h.video&&!h.audio?M="STREAM_TYPE_VIDEO":!h.video&&h.audio&&(M="STREAM_TYPE_AUDIO");c=g.Jg(O,"offlineVideoStreams");S={numBytesDownloaded:k.toFixed(),numTotalBytes:C.toFixed(),streamType:M,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(V),itag:M==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(h.itag):void 0};return g.t(Y,la(D,{mode:"readwrite",g2:!0},
function(J){var q=rf(J,c,"offlineVideoStreams"),u=rf(J,g.Jg(O,"transfer"),"transfer");return g.vs.all([q,u]).then(function(H){H=g.P(H);var m=H.next().value;H=H.next().value;if(!H)return ZM(J,c).then(function(){});
var R=epJ(m);m=LCS(m,V,S,c);var f=oN(J,m,"offlineVideoStreams");epJ(m)>R&&(H.lastProgressTimeMs=Date.now().toString());R=[f];H.offlineVideoStreams||(H.offlineVideoStreams=[]);H.offlineVideoStreams.indexOf(c)===-1&&(H.offlineVideoStreams.push(c),R.push(oN(J,H,"transfer")));return g.vs.all(R)})}),0)})},g7_=function(D,O){var h,V,k,C,M;
return g.Q(function(c){if(c.D==1)return h=g.Jg(O,"offlineVideoStreams"),g.t(c,$D(D,h,"offlineVideoStreams"),2);V=c.K;if(!V||!V.streamsProgress)return c.return();k=g.P(V.streamsProgress);for(C=k.next();!C.done;C=k.next())M=C.value,M.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",M.numTotalBytes!==M.numBytesDownloaded&&(M.numBytesDownloaded=M.numTotalBytes);return g.t(c,xD(D,V,"offlineVideoStreams"),0)})},LCS=function(D,O,h,V){if(D&&D.streamsProgress){V=D;
a:{O=O.itag+";"+O.xtags;for(var k=D.streamsProgress,C=0;C<k.length;C++){var M=JSON.parse(k[C].formatStreamBytes);if(M.itag+";"+M.xtags===O){k[C]=h;h=k;break a}}k.push(h);h=k}V.streamsProgress=h}else D={key:V,streamsProgress:[h]};return D},epJ=function(D){if(D==null?0:D.streamsProgress){var O=0;
D=D.streamsProgress;for(var h=0;h<D.length;h++){var V=D[h];isNaN(Number(V.numBytesDownloaded))?ku("stream progress bytes number invalid"):O+=Number(V.numBytesDownloaded)}return O}return 0},RpR=function(D,O,h,V){g.n.call(this);
var k=this;this.K=D;this.api=O;this.G2=h;this.jT=V;this.Z=new g.M7;this.W=new g.kF(function(){k.D&&k.D.transferState==="TRANSFER_STATE_TRANSFERRING"&&k.Z.Sf()&&((k.D.transferRetryCount||0)<3?Fc(k.L,k.J,!1,!1):nB(k.L,k.J.videoDetails.videoId),k.EZ("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.Ew=this.X1=0;this.U=this.T=!1;this.Vi=g.P5(this.api.V().experiments,"html5_transfer_processing_logs_interval");this.LF=new g.yp(this);this.HF={LKT:function(){return k.W},
qGT:function(){return k.jT},
Pb:function(){return k.Z}};
this.lS=this.K.observe(this.bM.bind(this));this.L=new Quc(O,this);this.Ax=new qpL(O);this.qE=new i1(this.K);this.ST=this.Z.listen("publicytnetworkstatus-online",this.Ne.bind(this));this.ME=this.Z.listen("publicytnetworkstatus-offline",this.IJT.bind(this));this.U=this.api.V().S("html5_less_transfer_processing_logs");g.F(this,this.LF);this.LF.G(O,"offlinetransferpause",this.fJT);g.Z$(this.api.V())?this.j="mainVideoDownloadStateEntity":g.pP(this.api.V())&&(this.j="musicTrackDownloadMetadataEntity")},
axc=function(D){return g.Q(function(O){if(O.D==1)O=g.t(O,D0U(),2);
else{var h=D.qE;var V=g.jq();V=Object.keys(V);h=mqC(h,V);O=g.t(O,h,0)}return O})},pB=function(D,O){O=O===void 0?!1:O;
var h;return g.Q(function(V){if(V.D==1){if(D.D)throw Error("Already downloading a video");D.Ew=0;D.T=!1;return g.t(V,fx8(D),2)}return V.D!=4?(h=V.K,jHx(D.G2,!h),h&&D.Z.Sf()?O?g.t(V,new Promise(function(k){g.fc(k,1E3)}),4):V.v3(4):(!h&&D.D&&rs(D),V.v3(0))):g.t(V,KCm(D,h),0)})},E7L=function(D){return g.Q(function(O){if(O.D==1)return D.J?g.t(O,nB(D.L,D.J.videoDetails.videoId),3):O.v3(0);
rs(D);g.LT(O)})},jZc=function(D,O){var h,V,k;
return g.Q(function(C){switch(C.D){case 1:return g.g2(C,2),(h=!!O.captionTracks.length||!!O.RK)?g.t(C,H7c(O.videoId),4):C.return();case 4:return(V=C.K)?C.return():g.t(C,u6v(D.Ax,O),5);case 5:g.ad(C,0);break;case 2:k=g.fT(C),ku("Caption downloading error",k,O.cotn),g.LT(C)}})},KCm=function(D,O){var h,V,k,C,M,c;
return g.Q(function(S){switch(S.D){case 1:if(D.T)return S.return();D.T=!0;D.D=O;h=g.Yy(D.D.key);V=h.entityId;k=void 0;if(D.D.transferState==="TRANSFER_STATE_TRANSFERRING")return g.t(S,NL(D,V),7);if(D.D.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||D.D.transferRetryCount||D.D.hasLoggedFirstStarted){S.v3(3);break}return g.t(S,NL(D,V),5);case 5:return k=S.K,D.D.hasLoggedFirstStarted=!0,g.t(S,Uqx(D),6);case 6:U0J({videoId:V,B8:D.D,offlineModeType:k},void 0,void 0,!0);S.v3(3);break;case 7:k=S.K,
Sp({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:V,B8:D.D,offlineModeType:k});case 3:return g.t(S,ABe(D),8);case 8:return C=null,g.g2(S,9),g.t(S,Gbx(D,O),11);case 11:C=S.K;D.J=C;g.ad(S,10);break;case 9:return M=g.fT(S),ku("error getting player response",M,O.cotn),g.t(S,D.EZ("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return S.return();case 10:return c=wte(D.api.V(),O.cotn,C),g.t(S,jZc(D,c),13);case 13:return g.t(S,suL(c.videoId),
14);case 14:c.Ze=S.K,zJe(D.L,c,O.maximumDownloadQuality),D.W.start(108E5),g.LT(S)}})},fx8=function(D){var O,h;
return g.Q(function(V){if(V.D==1)return g.t(V,IN(D.K,"transfer"),2);O=V.K;h=O.filter(t6L).sort(v7R);return h.length===0?V.return():V.return(h[0])})},ABe=function(D){var O,h,V;
return g.Q(function(k){if(k.D==1){if(!D.D)return oA(D,"onTransferStart"),k.return();D.W.start(108E5);return g.t(k,Za(D,"TRANSFER_STATE_TRANSFERRING"),2)}O=D.D;return(V=((h=O)==null?0:h.key)?g.Yy(O.key).entityId:"")&&D.j?g.t(k,Hm(V,D.j,D.K,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):k.v3(0)})},TML=function(D){var O,h,V,k;
g.Q(function(C){switch(C.D){case 1:if(!D.D){oA(D,"onTransferPausedByUser");C.v3(2);break}O=D.D;D.W.stop();return g.t(C,Za(D,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:V=((h=O)==null?0:h.key)?g.Yy(O.key).entityId:"";if(!V||!D.j){C.v3(4);break}return g.t(C,Hm(V,D.j,D.K,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.t(C,NL(D,V),6);case 6:k=C.K,Auv({videoId:V,B8:O,offlineModeType:k});case 2:rs(D),pB(D),g.LT(C)}})},dwR=function(D){var O,h,V;
g.Q(function(k){if(k.D==1){if(!D.D)return oA(D,"onTransferPausedByNetwork"),k.return();D.W.stop();return g.t(k,Za(D,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(k.D!=3)return O=D.D,(V=((h=O)==null?0:h.key)?g.Yy(O.key).entityId:"")&&D.j?g.t(k,Hm(V,D.j,D.K,"DOWNLOAD_STATE_PAUSED"),3):k.v3(3);rs(D);g.LT(k)})},QZ8=function(D){var O,h,V,k,C;
g.Q(function(M){switch(M.D){case 1:if(!D.D)return oA(D,"onTransferComplete"),M.return();O=D.D;D.W.stop();if(!O||!D.J){M.v3(2);break}h=wte(D.api.V(),O.cotn,D.J);return g.t(M,jZc(D,h),2);case 2:return g.t(M,Za(D,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:k=((V=O)==null?0:V.key)?g.Yy(O.key).entityId:"";if(!k||!D.j){M.v3(5);break}return g.t(M,Hm(k,D.j,D.K,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.t(M,g7_(D.K,k),7);case 7:return g.t(M,NL(D,k),8);case 8:C=M.K,Sp({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:k,B8:O,offlineModeType:C}),rs(D),pB(D),g.LT(M)}})},wzU=function(D,O,h){var V,k;
g.Q(function(C){switch(C.D){case 1:if(!D.D)return oA(D,"onTransferProgress: "+O),C.return();if(D.D.transferState==="TRANSFER_STATE_TRANSFERRING"){C.v3(2);break}return g.t(C,ABe(D),2);case 2:V=Date.now();if(!(V-D.X1>1E3)){C.v3(4);break}D.X1=V;return g.t(C,PjR(D.K,h.videoId,h.K,h.aX,h.bytesDownloaded,h.D),5);case 5:if(D.U&&!(D.U&&V-D.Ew>D.Vi)){C.v3(4);break}D.Ew=V;return g.t(C,NL(D,O),7);case 7:k=C.K,U0J({videoId:O,B8:D.D,offlineModeType:k},h.bytesDownloaded,h.D);case 4:D.W.start(108E5),g.LT(C)}})},
sZ_=function(D){var O=(D.D.transferRetryCount||0)<3;
O&&(D=D.D,D.transferRetryCount=(D.transferRetryCount||0)+1);return O},WCm=function(D,O){O=O===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":O;
var h,V,k,C;return g.Q(function(M){if(M.D==1)return D.D||oA(D,"setTransferToFailed: "+O),h="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O==="TRANSFER_FAILURE_REASON_NETWORK"?h="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":O==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(h="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.t(M,Za(D,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",O),2);if(M.D!=3)return ML(D.jT,{entityKey:(V=D.D)==null?void 0:V.key,failureReason:h}),
k=D.D?g.Yy(D.D.key).entityId:"",g.t(M,NL(D,k),3);C=M.K;var c={videoId:k,B8:D.D,offlineModeType:C},S=O,Y={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};S&&(Y.transferFailureReason=S,Y.failureReason=GOe(S));Sp(Y,c);g.LT(M)})},Za=function(D,O,h,V){var k;
return g.Q(function(C){if(C.D==1){if(!D.D)return oA(D,"saveTransferState: "+O),C.return();D.D.transferState=O;D.D.failureReason=V;g.g2(C,2);return g.t(C,Uqx(D,function(M){return h?pC(M,"offlineVideoStreams",D.D.offlineVideoStreams).then(function(c){for(var S=g.P(c),Y=S.next();!Y.done;Y=S.next())if((Y=Y.value)&&Y.streamsProgress){Y=g.P(Y.streamsProgress);for(var J=Y.next();!J.done;J=Y.next())J.value.streamState=h}return sKx(M,c.filter(function(q){return!!q}),"offlineVideoStreams")}):g.vs.resolve(void 0)}),
4)}if(C.D!=2)return g.ad(C,0);
k=g.fT(C);return k instanceof g.KQ&&k.type==="QUOTA_EXCEEDED"?g.t(C,D.EZ("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):C.v3(0)})},Uqx=function(D,O){var h;
return g.Q(function(V){if(!D.D)return V.return();h=D.D;return g.t(V,la(D.K,{mode:"readwrite",g2:!0},function(k){var C=[oN(k,h,"transfer")];O&&C.push(O(k));return g.vs.all(C)}),0)})},rs=function(D){D.D=void 0;
D.J=void 0;D.W.stop()},Gbx=function(D,O){var h,V,k,C,M;
return g.Q(function(c){if(c.D==1)return h=g.Yy(O.key),V=h.entityId,k=g.Jg(V,"playbackData"),g.t(c,$D(D.K,k,"playbackData"),2);C=c.K;if((M=C)==null?0:M.playerResponseJson)return c.return(JSON.parse(C.playerResponseJson));throw Error("No PlayerResponse found");})},oA=function(D,O){D.api.KF("woffle",{mcte:O});
ku("missing current transfer entity.")},NL=function(D,O){var h,V,k;
return g.Q(function(C){if(C.D==1)return g.t(C,$D(D.K,g.Jg(O,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);h=C.K;return C.return((k=(V=h)==null?void 0:V.offlineModeType)!=null?k:void 0)})},t6L=function(D){return TEC[D.transferState]!==void 0},v7R=function(D,O){var h=TEC[D.transferState],V=TEC[O.transferState];
return h!==V?h-V:Number(D.enqueuedTimestampMs)-Number(O.enqueuedTimestampMs)},Xc=function(D,O){var h=this;
this.D8=D;this.api=O;this.Z=new g.M7;this.J=new g.jh;this.HF={Ty:function(){return h.j.HF.Ty()},
Pb:function(){return h.Z},
z0E:function(){return h.j},
zf:function(){return h.zf()},
Fv:function(){return h.Fv()},
mB:function(){return h.mB()},
j9:function(){return h.j9()},
Dr:function(){return h.Dr()},
s9:function(V){return h.s9(V)}};
this.j=new aoR(function(){return dqR(h)},function(){h.mB()},this.api.EU(),this.api.S.bind(this.api));
this.D=new CB(this.api);fox(this.j)},dqR=function(D){return g.Q(function(O){D.api.F1("onOrchestrationBecameLeader");
return g.t(O,D.Fv(),0)})},n7v=function(D){var O,h;
return g.Q(function(V){if(V.D==1)return g.t(V,Da(),2);if(V.D!=3){O=V.K;if(!O)return ku("PES is undefined"),V.return();D.K=new RpR(O,D.api,D.j,D.D);h=D.Zy(O);return g.t(V,O7m(O,h,D.j,D.D,D.D8),3)}D.L=V.K;return g.t(V,zpx(D),0)})},zpx=function(D){var O;
return g.Q(function(h){switch(h.D){case 1:if(!D.K)return ku("transferManager is undefined"),h.return();if(D.K.D){h.v3(2);break}return g.t(h,pB(D.K),2);case 2:if(!D.D8.S("woffle_enable_main_downloads_library")){h.v3(4);break}return g.t(h,D.Kz(),4);case 4:if(!D.D8.S("html5_offline_playback_position_sync")){h.v3(6);break}return g.t(h,D.X8(),7);case 7:return g.t(h,D.s9(864E5),6);case 6:return g.t(h,D.refreshAllStaleEntities(43200,!0),9);case 9:return g.t(h,D.Vd(),10);case 10:if(!D.D8.S("html5_retry_downloads_for_expiration")){h.v3(11);
break}return g.t(h,D.Dr(),11);case 11:return D.T=g.Kc(function(){D.refreshAllStaleEntities(43200,!0);D.Vd()},9E5),g.CQ(g.bC(),function(){return D.j9()}),g.t(h,Da(),13);
case 13:return O=h.K,g.t(h,Rlx(O),14);case 14:KnR(D.j),g.LT(h)}})},FC9=function(){var D,O,h,V,k,C;
return g.Q(function(M){switch(M.D){case 1:return g.t(M,Da(),2);case 2:D=M.K;if(!D)return M.return([]);O=Date.now()/1E3;return g.t(M,IN(D,"offlineVideoPolicy"),3);case 3:h=M.K,V=g.P(h),k=V.next();case 4:if(k.done){M.v3(6);break}C=k.value;if(!(C.expirationTimestamp&&Number(C.expirationTimestamp)<O)){M.v3(5);break}C.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";C.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.t(M,xD(D,C,"offlineVideoPolicy"),5);
case 5:k=V.next();M.v3(4);break;case 6:return M.return(h.map(function(c){return c.key}))}})},Bm=function(D,O,h,V,k){var C,M,c;
return g.Q(function(S){if(S.D==1)return g.t(S,Da(),2);C=S.K;if(!C)return S.return([]);M=O.map(function(Y){var J=g.Jg(Y,h);J={actionType:V,entityKey:J,actionMetadata:Object.assign({},sH8(),k)};V!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(J.actionMetadata.priority=0);Y=new gs(h,Y,J);return aA(Y)});
c=rwL(C,M);fox(D.j);return S.return(c)})},yBc=function(D,O,h,V){var k,C,M,c,S,Y,J,q;
return g.Q(function(u){switch(u.D){case 1:k=[],C=g.P(O),M=C.next();case 2:if(M.done){u.v3(4);break}c=M.value;if(c.upToDate||h&&!c.shouldAutoSyncMetadata||!c.playlistId){u.v3(3);break}S={};switch(V){case "mainPlaylistEntity":Y={nextAutoRefreshIntervalSeconds:c.checkInSeconds,autoSync:h};S={mainPlaylistEntityActionMetadata:Y};break;case "musicPlaylist":J={autoSync:h},S={musicPlaylistEntityActionMetadata:J}}return g.t(u,Bm(D,[c.playlistId],V,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",S),6);case 6:(q=
u.K)&&k.push.apply(k,g.a(q));case 3:M=C.next();u.v3(2);break;case 4:return u.return(k)}})},i7L=function(D,O){var h;
return g.Q(function(V){return O.length?(h=sH8(),g.Z7(h,ds,{isEnqueuedForExpiredStreamUrlRefetch:!0}),D.api.KF("qrd",{v:O.length}),V.return(Bm(D,O,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",h))):V.return([])})},rBU=function(D,O,h){this.D=D;
this.D8=O;this.j=h},o78=function(D,O){var h,V,k,C,M,c,S,Y,J,q,u,H,m,R,f,E,A;
return g.Q(function(v){switch(v.D){case 1:return h=Yu(O),V=g.Yy(O.entityKey),k=V.entityId,C=[],g.g2(v,2),g.t(v,pz8(D,k),4);case 4:C=v.K;if(!(D.D8.S("woffle_enable_main_downloads_library")&&((M=C)==null?0:M.length))){v.v3(5);break}return g.t(v,ZsU(D.D,[O.entityKey]),5);case 5:g.ad(v,3);break;case 2:return c=g.fT(v),S="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",c instanceof g.KQ&&c.type==="QUOTA_EXCEEDED"?(S="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):ku("Playlist add error"),v.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,S,Y));case 3:J=[];if(!D.D8.S("html5_offline_prevent_redownload_downloaded_video")){v.v3(7);break}return g.t(v,QH8(D.D,"mainVideoEntity",C),8);case 8:C=v.K;case 7:if((q=C)==null?0:q.length)for(u=g.P(C),H=u.next();!H.done;H=u.next())if(m=H.value,R=m.offlineVideoData,f=void 0,(f=R)==null?0:f.videoId)E=void 0,A=Number(((E=O.actionMetadata)==null?void 0:E.priority)||
0)+1,J.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",R.videoId,"mainVideoEntity",A,l1,NEU(O,R,k)));return v.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,J))}})},Xz8=function(D,O){var h,V,k,C,M,c,S,Y,J,q,u,H,m,R,f,E,A,v,W,z,X,Z,hd,Yw,B,r,I,L,p,Id,aL,hx,Ad,OS,eR,lW,K,U,G,w,d,Dy,MP,kw,T,Jd,Pq,bW,Wq,b_,yc,un,NP,zV,JF,nb,Fj,yJ,Rr,Nt,Nf,il,ul,sQ,tb,uf,Wg,FS,vl,M3,ar,CW,Ep,rB;
return g.Q(function(H6){switch(H6.D){case 1:return h=Yu(O),V=O.entityKey,k=g.Yy(V).entityId,C=[],M=!1,k==="!*$_ALL_ENTITIES_!*$"?(M=!0,g.t(H6,IN(D.D,"mainPlaylistEntity"),5)):g.t(H6,$D(D.D,V,"mainPlaylistEntity"),4);case 4:(c=H6.K)&&C.push(c);H6.v3(3);break;case 5:C=H6.K;case 3:if((S=C)==null||!S.length)return H6.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));Y=g.y(O.actionMetadata,Z7R);q=(J=Y)==null?void 0:J.nextAutoRefreshIntervalSeconds;H=(u=Y)==null?void 0:u.autoSync;m=[];f=R=
!0;E=!1;if(!M&&H===!1){H6.v3(6);break}g.g2(H6,7);return g.t(H6,bSv(0,!!H,!0,C),9);case 9:m=H6.K;g.ad(H6,8);break;case 7:A=g.fT(H6);if(!(A instanceof Error&&A.message==="No data")){A instanceof Error&&A.message==="Empty response body"&&ku(A.message);H6.v3(8);break}return k==="!*$_ALL_ENTITIES_!*$"?g.t(H6,yux(D.D,O,D.j,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.t(H6,nBL(k,D.D,O,D.j),8);case 8:if(!m.length||!M&&m[0].playlistId!==k)return H6.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h));case 6:if(M){v=[];W=g.P(m);for(z=W.next();!z.done;z=W.next())X=z.value,X.upToDate||H&&!X.shouldAutoSyncMetadata||!X.playlistId||(Z={nextAutoRefreshIntervalSeconds:X.checkInSeconds,autoSync:H},v.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",X.playlistId,"mainPlaylistEntity",0,l1,{mainPlaylistEntityActionMetadata:Z})));return H6.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,v))}m.length&&(hd=m[0],E=!!hd.upToDate,H&&(R=(Yw=hd.shouldAutoSyncMetadata)!=null?Yw:!0,f=(B=hd.shouldAutoSyncVideos)!=
null?B:!0,hd.checkInSeconds&&(q=hd.checkInSeconds)));if(E||!R)return H6.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));r=[];I=C[0];if(!I.downloadState){L=void 0;H6.v3(15);break}return g.t(H6,$D(D.D,I.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:L=H6.K;case 15:return p=L,aL=((Id=p)==null?0:Id.addedTimestampMillis)?String(p.addedTimestampMillis):void 0,g.g2(H6,17),g.t(H6,pz8(D,k,aL,q),19);case 19:r=H6.K;g.ad(H6,18);break;case 17:hx=g.fT(H6);if(!(hx instanceof Error&&
hx.message==="No data for playlist")){if(hx instanceof Error&&hx.message==="Empty response body for playlist")ku(hx.message);else return Ad="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",OS="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",hx instanceof g.KQ&&hx.type==="QUOTA_EXCEEDED"&&(Ad="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",OS="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),H6.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,Ad,OS));H6.v3(18);
break}return g.t(H6,nBL(k,D.D,O,D.j),18);case 18:if(!f)return H6.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));eR=[];lW=new Map;if((K=r)==null?0:K.length)for(U=g.P(r),G=U.next();!G.done;G=U.next())w=G.value,d=w.offlineVideoData,Dy=void 0,((Dy=d)==null?0:Dy.videoId)&&lW.set(d.videoId,d);MP=new Map;kw=[];if((T=I)==null?0:(Jd=T.videos)==null?0:Jd.length)for(Pq=g.P(I.videos),bW=Pq.next();!bW.done;bW=Pq.next())if(Wq=bW.value,b_=JSON.parse(g.Yy(Wq).entityId),yc=b_.videoId)lW.has(yc)?(MP.set(yc,
lW.get(yc)),lW.delete(yc)):kw.push(yc);NP=Number(((un=O.actionMetadata)==null?void 0:un.priority)||0)+1;zV=g.P(lW.entries());for(JF=zV.next();!JF.done;JF=zV.next())nb=JF.value,Fj=g.P(nb),yJ=Fj.next().value,Rr=Fj.next().value,Nt=yJ,Nf=Rr,eR.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Nt,"mainVideoEntity",NP,l1,NEU(O,Nf,k)));il=g.P(MP.entries());for(ul=il.next();!ul.done;ul=il.next())sQ=ul.value,tb=g.P(sQ),uf=tb.next().value,Wg=tb.next().value,FS=uf,vl=Wg,eR.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
FS,"mainVideoEntity",NP,l1,NEU(O,vl,k)));M3=g.P(kw);for(ar=M3.next();!ar.done;ar=M3.next())CW=ar.value,Ep={playlistId:k},rB={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:Ep},eR.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",CW,"mainVideoEntity",0,l1,rB));return H6.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,eR))}})},BEe=function(D,O){var h,V,k,C;
return g.Q(function(M){switch(M.D){case 1:return h=Yu(O),g.g2(M,2),V=g.Yy(O.entityKey).entityId,V==="!*$_ALL_ENTITIES_!*$"?g.t(M,yux(D.D,O,D.j,(k=O.actionMetadata)==null?void 0:(C=k.offlineLoggingData)==null?void 0:C.offlineDeleteReason),5):g.t(M,nBL(V,D.D,O,D.j),6);case 6:if(!D.D8.S("woffle_enable_main_downloads_library")){M.v3(5);break}return g.t(M,XtR(D.D,O.entityKey),5);case 5:g.ad(M,3);break;case 2:return g.fT(M),M.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return M.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h))}})},pz8=function(D,O,h,V){var k,C,M,c,S,Y,J;
return g.Q(function(q){switch(q.D){case 1:return g.t(q,Ctc([O]),2);case 2:return k=q.K,g.t(q,lxc(D,k[0],h,V),3);case 3:return C=q.K,M=C.mainPlaylistEntity,c=C.cr1,Y=d0e(M,(S=c)==null?void 0:S.avatar),g.g2(q,4),g.t(q,KB(Y),6);case 6:g.ad(q,5);break;case 4:J=g.fT(q),J instanceof Error&&J.message==="Failed to fetch"&&ku(J.message);case 5:return q.return(k[0].videos)}})},lxc=function(D,O,h,V){var k,C,M,c,S,Y,J,q,u,H,m,R,f,E,A,v,W;
return g.Q(function(z){switch(z.D){case 1:k=Date.now().toString();h||(h=k);C=O.videos;M=O.playlistId;c=[];S=[];if(C)for(Y=g.P(C),J=Y.next();!J.done;J=Y.next()){q=J.value;u=q.offlineVideoData;if(!u||!u.videoId)throw ku("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");H=u.videoId;m={videoId:H,playlistId:M};R={id:g.Jg(JSON.stringify(m),"mainPlaylistVideoEntity"),video:g.Jg(H,"mainVideoEntity")};c.push(R);S.push(R.id)}E={key:g.Jg(M,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:h,lastSyncedTimestampMillis:k};A={key:g.Jg(M,"mainPlaylistEntity"),playlistId:M,videos:S,title:O.title,thumbnailStyleData:xqx(O),visibility:$qR(O),downloadState:E.key};O.channel&&(v=O.channel.offlineChannelData,f=IxC(g.Jg(M,"ytMainChannelEntity"),v),A.channelOwner=f.id);((W=A)==null?0:W.entityMetadata)?(A.entityMetadata.offlineLastModifiedTimestampSeconds=O.lastModifiedTimestamp,V&&(A.entityMetadata.nextAutoRefreshIntervalSeconds=String(V))):A&&(A.entityMetadata={nextAutoRefreshIntervalSeconds:V?
String(V):void 0,offlineLastModifiedTimestampSeconds:O.lastModifiedTimestamp});g.g2(z,2);return g.t(z,la(D.D,{mode:"readwrite",g2:!0},function(X){var Z=oN(X,A,"mainPlaylistEntity"),hd=oN(X,E,"mainPlaylistDownloadStateEntity");Z=[Z,hd];hd=g.P(c);for(var Yw=hd.next();!Yw.done;Yw=hd.next())Z.push(oN(X,Yw.value,"mainPlaylistVideoEntity"));f&&Z.push(oN(X,f,"ytMainChannelEntity"));return g.vs.all(Z)}),4);
case 4:g.ad(z,3);break;case 2:throw g.fT(z),ku("PES failure for playlist"),Error("PES failure for playlist");case 3:return z.return({mainPlaylistEntity:A,cr1:f,M5E:c})}})},IxC=function(D,O){return{id:D,
channelId:O.channelId,title:O.title,avatar:O.thumbnail}},xqx=function(D){var O=[],h=D.videos;
h&&h.length>0&&O.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:h[0].offlineVideoData.thumbnail}}});if((D=D.additionalMetadadatas)&&D.length>0)for(D=g.P(D),h=D.next();!h.done;h=D.next()){var V=h.value.offlineBundleItemPlaylistData,k=void 0;h=(k=V)==null?void 0:k.style;k=void 0;V={collageThumbnail:{coverThumbnail:(k=V)==null?void 0:k.coverThumbnail}};switch(h){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":O.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:V});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":O.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:V});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":O.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:V});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":O.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:V})}}return O},$qR=function(D){switch(D.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},NEU=function(D,O,h){O={offlineVideoData:O,
playlistId:h};if(D=g.y(D.actionMetadata,Z7R))O.maximumDownloadQuality=D.maximumDownloadQuality;return{mainVideoEntityActionMetadata:O}},DZL=function(D,O,h){this.D=D;
this.D8=O;this.j=h},VXC=function(D,O){var h,V,k,C,M,c,S,Y,J,q,u,H,m;
return g.Q(function(R){switch(R.D){case 1:return h=Yu(O),V=g.Yy(O.entityKey),k=V.entityId,C=g.y(O.actionMetadata,xu),c=!((M=C)==null?0:M.playlistId),g.g2(R,2),g.t(R,Odm(D,k,void 0,(S=C)==null?void 0:S.offlineVideoData,c),4);case 4:g.ad(R,3);break;case 2:return Y=g.fT(R),J="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Y instanceof g.KQ&&Y.type==="QUOTA_EXCEEDED"&&(J="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
R.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,J,q));case 3:u=1;u=Number(((H=O.actionMetadata)==null?void 0:H.priority)||0)+1;var f=(f=g.y(O.actionMetadata,xu))?{playbackDataActionMetadata:{maximumDownloadQuality:f.maximumDownloadQuality}}:void 0;m=Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",k,"playbackData",u,haS,f);return R.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,[m]))}})},kc8=function(D,O){var h,V,k,C,M,c,S,Y,J,q,u,H,m,R,f,E,A;
return g.Q(function(v){switch(v.D){case 1:return h=Yu(O),V=g.Yy(O.entityKey),k=V.entityId,g.t(v,$D(D.D,O.entityKey,"mainVideoEntity"),2);case 2:C=v.K;if(!C){M=void 0;v.v3(3);break}return g.t(v,$D(D.D,C.downloadState,"mainVideoDownloadStateEntity"),4);case 4:M=v.K;case 3:c=M;if(!C||!c)return v.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));g.g2(v,5);return g.t(v,Odm(D,k,c.addedTimestampMillis,(Y=g.y(O.actionMetadata,xu))==null?void 0:Y.offlineVideoData),7);case 7:J=1;J=Number(((q=
O.actionMetadata)==null?void 0:q.priority)||0)+1;S=Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",k,"playbackData",J,haS);g.ad(v,6);break;case 5:u=g.fT(v);if(!(u instanceof Error&&u.message==="No data")){if(u instanceof Error&&u.message==="Empty response body")ku(u.message);else return H="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",m="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",u instanceof g.KQ&&u.type==="QUOTA_EXCEEDED"&&(H="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
m="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),v.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,H,m));v.v3(6);break}return g.t(v,Ux(D.D,k),9);case 9:R=v.K;f=g.y(O.actionMetadata,xu);if(A=(E=f)==null?void 0:E.playlistId)R.playlistId=A;R.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.t(v,Ex(k,D.D,O,D.j,R),6);case 6:return v.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,S?[S]:void 0))}})},CYx=function(D,O){var h,V,k,C,M,c,S,Y,J,q;
return g.Q(function(u){switch(u.D){case 1:return h=Yu(O),g.g2(u,2),V=g.Yy(O.entityKey).entityId,V==="!*$_ALL_ENTITIES_!*$"?g.t(u,yux(D.D,O,D.j,(J=O.actionMetadata)==null?void 0:(q=J.offlineLoggingData)==null?void 0:q.offlineDeleteReason),5):g.t(u,Ux(D.D,V),6);case 6:k=u.K;C=g.y(O.actionMetadata,xu);if(c=(M=C)==null?void 0:M.playlistId)k.playlistId=c;k.offlineDeleteReason=(S=O.actionMetadata)==null?void 0:(Y=S.offlineLoggingData)==null?void 0:Y.offlineDeleteReason;return g.t(u,Ex(V,D.D,O,D.j,k),7);
case 7:if(!D.D8.S("woffle_enable_main_downloads_library")){u.v3(5);break}return g.t(u,XtR(D.D,O.entityKey),5);case 5:g.ad(u,3);break;case 2:return g.fT(u),u.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return u.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h))}})},Odm=function(D,O,h,V,k){var C,M,c,S,Y,J;
return g.Q(function(q){switch(q.D){case 1:if(C=V){q.v3(2);break}return g.t(q,kx8([O]),3);case 3:M=q.K,C=M[0];case 2:return g.t(q,MXv(D,C,h,k),4);case 4:c=q.K;S=c.mainVideoEntity;Y=c.channelEntity;g.g2(q,5);var u=Pm(S.thumbnail),H=Pm(Y.avatar);return g.t(q,KB(u.concat(H)),7);case 7:g.ad(q,0);break;case 5:J=g.fT(q),J instanceof Error&&J.message==="Failed to fetch"&&ku(J.message),g.LT(q)}})},MXv=function(D,O,h,V){var k,C,M,c,S,Y,J,q,u,H,m,R,f;
return g.Q(function(E){switch(E.D){case 1:h||(h=Date.now().toString());C=(k=O.channel)==null?void 0:k.offlineChannelData;M={id:g.Jg(O.videoId,"ytMainChannelEntity"),channelId:C.channelId,title:C.title,avatar:C.thumbnail};c={key:g.Jg(O.videoId,"mainVideoDownloadStateEntity"),playbackData:g.Jg(O.videoId,"playbackData"),addedTimestampMillis:h,videoDownloadContextEntity:g.Jg(O.videoId,"videoDownloadContextEntity")};S={key:g.Jg(O.videoId,"videoPlaybackPositionEntity"),videoId:O.videoId,lastPlaybackPositionSeconds:"0"};
D.D8.S("html5_offline_playback_position_sync")&&(Y={playbackPosition:S.key});J=g.Jg(O.videoId,"mainVideoEntity");q={key:J,videoId:O.videoId,title:O.title,thumbnail:O.thumbnail,localizedStrings:{viewCount:O.shortViewCountText},userState:Y,lengthSeconds:O.lengthSeconds?Number(O.lengthSeconds):void 0,publishedTimestampMillis:O.publishedTimestamp?(Number(O.publishedTimestamp)*1E3).toString():void 0,formattedDescription:O.description,owner:M.id,downloadState:c.key};if(!D.D8.S("woffle_enable_main_downloads_library")||
!V){E.v3(2);break}return g.t(E,oBU(D.D,[J]),3);case 3:if(m=E.K)u=m.mainDownloadsLibraryEntity,H=m.mainDownloadsListEntity;case 2:return f=vBC,R={key:g.Jg(O.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.Z7(c,f,R),g.t(E,la(D.D,{mode:"readwrite",g2:!0},function(A){var v=oN(A,M,"ytMainChannelEntity"),W=oN(A,c,"mainVideoDownloadStateEntity"),z=oN(A,q,"mainVideoEntity");v=[v,W,z];D.D8.S("html5_offline_playback_position_sync")&&(W=oN(A,S,"videoPlaybackPositionEntity"),
v.push(W));u&&(W=oN(A,u,"mainDownloadsLibraryEntity"),v.push(W));H&&(W=oN(A,H,"mainDownloadsListEntity"),v.push(W));R&&(A=oN(A,R,"downloadStatusEntity"),v.push(A));return g.vs.all(v)}),4);
case 4:return E.return({mainVideoEntity:q,channelEntity:M})}})},bdc=function(D,O,h){this.D=D;
this.D8=O;this.j=h},SVm=function(D,O){var h,V,k,C,M,c,S,Y,J,q,u,H,m,R,f,E,A,v,W,z,X,Z,hd,Yw,B,r,I;
return g.Q(function(L){switch(L.D){case 1:return h=Yu(O),V=[],g.t(L,FV.getInstance(),2);case 2:k=L.K;if(!k){L.v3(3);break}return g.t(L,k.get("sdois"),4);case 4:return C=L.K,g.t(L,(c=k)==null?void 0:c.get("lmqf"),5);case 5:M=L.K;case 3:g.g2(L,6);if(C===void 0)throw Error("prefStorage or opt-in state is undefined");S=[];if(C){L.v3(8);break}return g.t(L,NJx(D.D),9);case 9:S=L.K,S.reverse();case 8:if(!S.length){L.v3(10);break}Y=g.P(S);J=Y.next();case 11:if(J.done){L.v3(10);break}q=J.value;if(!q){L.v3(12);
break}u=g.Yy(q).entityId;return g.t(L,Ux(D.D,u),14);case 14:return H=L.K,H.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.t(L,Ex(u,D.D,{entityKey:q,actionType:O.actionType},D.j,H),12);case 12:J=Y.next();L.v3(11);break;case 10:return g.t(L,Si8(C,(m=M)!=null?m:"SD"),16);case 16:return R=L.K,g.t(L,isJ(R),17);case 17:f=ptC(R);if(!D.D8.S("woffle_enable_main_downloads_library")){L.v3(18);break}if(C){L.v3(19);break}return g.t(L,XtR(D.D,g.sn),19);case 19:return g.t(L,ZsU(D.D,[g.sn]),18);
case 18:if((E=f)==null?0:E.length)for(A=g.P(f),v=A.next();!v.done;v=A.next())if(z=W=v.value,X=z.actionType,Z=z.entityKey,hd=z.actionMetadata,X&&Z&&hd&&!g.y(hd,cXL)){X==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(hd.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(Yw=g.y(W.actionMetadata,xu))Yw.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",W.actionMetadata=Object.assign({},W.actionMetadata,{mainVideoEntityActionMetadata:Yw});V.push(W)}g.ad(L,7);break;
case 6:return B=g.fT(L),r="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",I="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",B instanceof g.KQ&&B.type==="QUOTA_EXCEEDED"&&(r="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",I="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),L.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,r,I));case 7:return L.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,V))}})},YVv=function(){Xc.apply(this,arguments);
this.U="mainVideoEntity"},JXv=function(D,O,h){O=O===void 0?43200:O;
h=h===void 0?!0:h;var V=V===void 0?!1:V;var k,C,M;return g.Q(function(c){switch(c.D){case 1:if(!D.Z.Sf())return c.return([]);k=[];g.g2(c,2);return g.t(c,bSv(O,h,V),4);case 4:k=c.K;g.ad(c,3);break;case 2:C=g.fT(c),C instanceof Error&&C.message==="No data"||C instanceof Error&&C.message==="Empty response body"&&ku(C.message);case 3:return M=yBc(D,k,h,"mainPlaylistEntity"),c.return(M)}})},qVJ=function(D,O,h,V){V=V===void 0?!1:V;
var k,C,M,c,S,Y,J,q,u,H,m,R,f,E,A;return g.Q(function(v){switch(v.D){case 1:return k=[],g.t(v,cr8(),2);case 2:return(C=v.K)||V?g.t(v,Yic(O,h),3):v.return([]);case 3:M=v.K;if((c=M)==null||!c.length)return v.return([]);S={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};Y=g.P(M);J=Y.next();case 4:if(J.done){v.v3(6);break}u=q=J.value;H=u.actionType;m=u.entityKey;R=u.actionMetadata;if(!(H&&m&&R)||g.y(R,cXL)){v.v3(5);break}H==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(R.offlineLoggingData=
S);f=g.Yy(m);E=f.entityId;return g.t(v,Bm(D,[E],"mainVideoEntity",H,R),8);case 8:A=v.K,k=k.concat(A);case 5:J=Y.next();v.v3(4);break;case 6:return v.return(k)}})},uI8=function(D,O){this.D=D;
this.j=O},mZe=function(D,O){var h,V,k,C,M,c,S,Y,J,q,u,H,m,R,f,E;
return g.Q(function(A){switch(A.D){case 1:return h=Yu(O),V=g.Yy(O.entityKey),k=V.entityId,C=[],g.g2(A,2),g.t(A,Hd_(D,k),4);case 4:C=A.K;if((M=C)==null||!M.length){A.v3(5);break}return g.t(A,Ioe(D.D,O.entityKey),5);case 5:g.ad(A,3);break;case 2:return c=g.fT(A),S="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",c instanceof g.KQ&&c.type==="QUOTA_EXCEEDED"&&(S="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
A.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,S,Y));case 3:return J=[],g.t(A,QH8(D.D,"musicTrack",C),7);case 7:C=A.K;if(C.length)for(q=g.P(C),u=q.next();!u.done;u=q.next())if(H=u.value,m=H.offlineVideoData,R=void 0,(R=m)==null?0:R.videoId)f=void 0,E=Number(((f=O.actionMetadata)==null?void 0:f.priority)||0)+1,J.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",m.videoId,"musicTrack",E,$u,vm(O,m,k)));return A.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,J))}})},
eaR=function(D,O){var h,V,k,C,M,c,S,Y,J,q,u,H,m,R,f,E,A,v,W,z,X,Z,hd,Yw,B,r,I,L,p,Id,aL,hx,Ad,OS,eR,lW,K,U,G,w,d,Dy,MP,kw,T,Jd,Pq,bW,Wq,b_,yc,un,NP,zV,JF,nb,Fj,yJ,Rr;
return g.Q(function(Nt){switch(Nt.D){case 1:return h=Yu(O),V=O.entityKey,k=g.Yy(V).entityId,C=[],M=!1,k==="!*$_ALL_ENTITIES_!*$"?(M=!0,g.t(Nt,IN(D.D,"musicAlbumRelease"),5)):g.t(Nt,$D(D.D,V,"musicAlbumRelease"),4);case 4:(c=Nt.K)&&C.push(c);Nt.v3(3);break;case 5:C=Nt.K;case 3:if((S=C)==null||!S.length)return Nt.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));if(M){Y=[];J=g.P(C);for(q=J.next();!q.done;q=J.next())u=q.value,H=g.Yy(u.id).entityId,Y.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
H,"musicAlbumRelease",0,$u));return Nt.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,Y))}m=[];R=C[0];f=void 0;if(!R.downloadMetadata){Nt.v3(6);break}return g.t(Nt,$D(D.D,R.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:E=Nt.K,f=Number((v=(A=E)==null?void 0:A.addedTimestampMillis)!=null?v:"0")/1E3;case 6:return g.g2(Nt,8),g.t(Nt,Hd_(D,k,(W=f)==null?void 0:W.toString()),10);case 10:m=Nt.K;g.ad(Nt,9);break;case 8:z=g.fT(Nt);if(!(z instanceof Error&&z.message===
"No data")){if(z instanceof Error&&z.message==="Empty response body")ku(z.message);else return X="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",z instanceof g.KQ&&z.type==="QUOTA_EXCEEDED"&&(X="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Nt.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,X,Z));Nt.v3(9);break}return g.t(Nt,GQ(k,"musicAlbumRelease",D.D,
O,D.j),9);case 9:hd=[];Yw=new Map;if((B=m)==null?0:B.length)for(r=g.P(m),I=r.next();!I.done;I=r.next())L=I.value,p=L.offlineVideoData,Id=void 0,((Id=p)==null?0:Id.videoId)&&Yw.set(p.videoId,p);aL=new Map;hx=[];if((Ad=R)==null?0:(OS=Ad.tracks)==null?0:OS.length)for(eR=g.P(R.tracks),lW=eR.next();!lW.done;lW=eR.next())if(K=lW.value,U=g.Yy(K).entityId)Yw.has(U)?(aL.set(U,Yw.get(U)),Yw.delete(U)):hx.push(U);w=Number(((G=O.actionMetadata)==null?void 0:G.priority)||0)+1;d=g.P(Yw.entries());for(Dy=d.next();!Dy.done;Dy=
d.next())MP=Dy.value,kw=g.P(MP),T=kw.next().value,Jd=kw.next().value,Pq=T,bW=Jd,hd.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Pq,"musicTrack",w,$u,vm(O,bW)));Wq=g.P(aL.entries());for(b_=Wq.next();!b_.done;b_=Wq.next())yc=b_.value,un=g.P(yc),NP=un.next().value,zV=un.next().value,JF=NP,nb=zV,hd.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",JF,"musicTrack",w,$u,vm(O,nb)));Fj=g.P(hx);for(yJ=Fj.next();!yJ.done;yJ=Fj.next())Rr=yJ.value,hd.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Rr,
"musicTrack",0,$u));return Nt.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,hd))}})},Lyx=function(D,O){var h,V;
return g.Q(function(k){switch(k.D){case 1:return h=Yu(O),g.g2(k,2),V=g.Yy(O.entityKey).entityId,V==="!*$_ALL_ENTITIES_!*$"?g.t(k,t_(D.D,O,D.j),5):g.t(k,GQ(V,"musicAlbumRelease",D.D,O,D.j),6);case 6:return g.t(k,DwR(D.D,O.entityKey),5);case 5:g.ad(k,3);break;case 2:return g.fT(k),k.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return k.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h))}})},Hd_=function(D,O,h){var V,k,C;
return g.Q(function(M){switch(M.D){case 1:return g.t(M,Ctc([O]),2);case 2:return V=M.K,g.t(M,PYR(D,V[0],h),3);case 3:return k=M.K,C=Pm(k.thumbnailDetails),g.t(M,KB(C),4);case 4:return M.return(V[0].videos)}})},PYR=function(D,O,h){var V,k,C,M,c,S,Y,J,q,u,H,m,R,f;
return g.Q(function(E){if(E.D==1){V=O.additionalMetadadatas;k=void 0;if(V&&V.length>0)for(C=g.P(V),M=C.next();!M.done;M=C.next())if(c=M.value,c.offlineMusicPlaylistData){k=c.offlineMusicPlaylistData;break}S=O.playlistId;Y=OSS(O);J=Y.Vx;q=Y.G1;u=h?(Number(h)*1E3).toString():Date.now().toString();H=O.lastModifiedTimestamp?(Number(O.lastModifiedTimestamp)*1E3).toString():"0";m={id:g.Jg(S,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:q,lastModifiedTimestampMillis:H,addedTimestampMillis:u,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};R={id:g.Jg(S,"musicAlbumRelease"),title:O.title,audioPlaylistId:S,trackCount:O.totalVideoCount,tracks:J,downloadMetadata:m.id};k&&(R.thumbnailDetails=(f=k.albumHqThumbnail)!=null?f:k.albumArtistThumbnail,R.artistDisplayName=k.albumArtistDisplayName,R.releaseDate=k.albumReleaseDate,R.contentRating={explicitType:k.albumReleaseExplicitType},R.releaseType=k.albumReleaseType);return g.t(E,la(D.D,{mode:"readwrite",g2:!0},function(A){var v=oN(A,R,"musicAlbumRelease");
A=oN(A,m,"musicAlbumReleaseDownloadMetadataEntity");return g.vs.all([v,A])}),2)}return E.return(R)})},gFm=function(D,O){this.D=D;
this.j=O},aDR=function(D,O){var h,V,k,C,M,c,S,Y,J,q,u,H,m,R,f,E;
return g.Q(function(A){switch(A.D){case 1:return h=Yu(O),V=g.Yy(O.entityKey),k=V.entityId,C=[],g.g2(A,2),g.t(A,Rav(D,k),4);case 4:C=A.K;if((M=C)==null||!M.length){A.v3(5);break}return g.t(A,Ioe(D.D,O.entityKey),5);case 5:g.ad(A,3);break;case 2:return c=g.fT(A),S="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",c instanceof g.KQ&&c.type==="QUOTA_EXCEEDED"&&(S="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
A.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,S,Y));case 3:return J=[],g.t(A,QH8(D.D,"musicTrack",C),7);case 7:C=A.K;if(C.length)for(q=g.P(C),u=q.next();!u.done;u=q.next())if(H=u.value,m=H.offlineVideoData,R=void 0,(R=m)==null?0:R.videoId)f=void 0,E=Number(((f=O.actionMetadata)==null?void 0:f.priority)||0)+1,J.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",m.videoId,"musicTrack",E,IA,vm(O,m,k)));return A.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,J))}})},
fDS=function(D,O){var h,V,k,C,M,c,S,Y,J,q,u,H,m,R,f,E,A,v,W,z,X,Z,hd,Yw,B,r,I,L,p,Id,aL,hx,Ad,OS,eR,lW,K,U,G,w,d,Dy,MP,kw,T,Jd,Pq,bW,Wq,b_,yc,un,NP,zV,JF,nb,Fj,yJ,Rr,Nt,Nf,il,ul,sQ,tb,uf,Wg,FS,vl,M3,ar;
return g.Q(function(CW){switch(CW.D){case 1:return h=Yu(O),V=O.entityKey,k=g.Yy(V).entityId,C=[],M=!1,k==="!*$_ALL_ENTITIES_!*$"?(M=!0,g.t(CW,IN(D.D,"musicPlaylist"),5)):g.t(CW,$D(D.D,V,"musicPlaylist"),4);case 4:(c=CW.K)&&C.push(c);CW.v3(3);break;case 5:C=CW.K;case 3:if((S=C)==null||!S.length)return CW.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));Y=g.y(O.actionMetadata,hJR);q=(J=Y)==null?void 0:J.autoSync;u=[];m=H=!0;R=!1;f=void 0;if(!M&&q===!1){CW.v3(6);break}g.g2(CW,7);return g.t(CW,
JrS(0,!!q,!0,C),9);case 9:u=CW.K;g.ad(CW,8);break;case 7:E=g.fT(CW);if(!(E instanceof Error&&E.message==="No data")){E instanceof Error&&E.message==="Empty response body"&&ku(E.message);CW.v3(8);break}return k==="!*$_ALL_ENTITIES_!*$"?g.t(CW,t_(D.D,O,D.j),8):g.t(CW,GQ(k,"musicPlaylist",D.D,O,D.j),8);case 8:if(!u.length||!M&&u[0].playlistId!==k)return CW.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));case 6:if(M){A=[];v=g.P(u);for(W=v.next();!W.done;W=v.next())z=W.value,z.upToDate||
q&&!z.shouldAutoSyncMetadata||!z.playlistId||(X={autoSync:q},A.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",z.playlistId,"musicPlaylist",0,IA,{musicPlaylistEntityActionMetadata:X})));return CW.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,A))}u.length&&(Z=u[0],R=!!Z.upToDate,q&&(H=(hd=Z.shouldAutoSyncMetadata)!=null?hd:!0,m=(Yw=Z.shouldAutoSyncVideos)!=null?Yw:!0,Z.checkInSeconds&&(f=Z.checkInSeconds)));if(R||!H)return CW.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h));B=[];r=C[0];I=void 0;if(!r.downloadMetadata){CW.v3(15);break}return g.t(CW,$D(D.D,r.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:L=CW.K,I=Number((Id=(p=L)==null?void 0:p.addedTimestampMillis)!=null?Id:"0")/1E3;case 15:return g.g2(CW,17),g.t(CW,Rav(D,k,(aL=I)==null?void 0:aL.toString(),f),19);case 19:B=CW.K;g.ad(CW,18);break;case 17:hx=g.fT(CW);if(!(hx instanceof Error&&hx.message==="No data")){if(hx instanceof Error&&hx.message==="Empty response body")ku(hx.message);else return Ad=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",OS="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",hx instanceof g.KQ&&hx.type==="QUOTA_EXCEEDED"&&(Ad="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",OS="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),CW.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,Ad,OS));CW.v3(18);break}return g.t(CW,GQ(k,"musicPlaylist",D.D,O,D.j),18);case 18:if(!m)return CW.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h));eR=[];lW=new Map;if((K=B)==null?0:K.length)for(U=g.P(B),G=U.next();!G.done;G=U.next())w=G.value,d=w.offlineVideoData,Dy=void 0,((Dy=d)==null?0:Dy.videoId)&&lW.set(d.videoId,d);MP=new Map;kw=[];if((T=r)==null?0:(Jd=T.tracks)==null?0:Jd.length)for(Pq=g.P(r.tracks),bW=Pq.next();!bW.done;bW=Pq.next())if(Wq=bW.value,b_=g.Yy(Wq).entityId)lW.has(b_)?(MP.set(b_,lW.get(b_)),lW.delete(b_)):kw.push(b_);un=Number(((yc=O.actionMetadata)==null?void 0:yc.priority)||0)+1;NP=g.P(lW.entries());for(zV=NP.next();!zV.done;zV=
NP.next())JF=zV.value,nb=g.P(JF),Fj=nb.next().value,yJ=nb.next().value,Rr=Fj,Nt=yJ,eR.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Rr,"musicTrack",un,IA,vm(O,Nt)));Nf=g.P(MP.entries());for(il=Nf.next();!il.done;il=Nf.next())ul=il.value,sQ=g.P(ul),tb=sQ.next().value,uf=sQ.next().value,Wg=tb,FS=uf,eR.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Wg,"musicTrack",un,IA,vm(O,FS)));vl=g.P(kw);for(M3=vl.next();!M3.done;M3=vl.next())ar=M3.value,eR.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
ar,"musicTrack",0,IA));return CW.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,eR))}})},KyU=function(D,O){var h,V;
return g.Q(function(k){switch(k.D){case 1:return h=Yu(O),g.g2(k,2),V=g.Yy(O.entityKey).entityId,V==="!*$_ALL_ENTITIES_!*$"?g.t(k,t_(D.D,O,D.j),5):g.t(k,GQ(V,"musicPlaylist",D.D,O,D.j),6);case 6:return g.t(k,DwR(D.D,O.entityKey),5);case 5:g.ad(k,3);break;case 2:return g.fT(k),k.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return k.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h))}})},Rav=function(D,O,h,V){var k,C,M;
return g.Q(function(c){switch(c.D){case 1:return g.t(c,Ctc([O]),2);case 2:return k=c.K,g.t(c,EFe(D,k[0],h,V),3);case 3:return C=c.K,M=Pm(C.thumbnailDetails),g.t(c,KB(M),4);case 4:return c.return(k[0].videos)}})},EFe=function(D,O,h,V){var k,C,M,c,S,Y,J,q,u;
return g.Q(function(H){return H.D==1?(k=O.playlistId,C=OSS(O),M=C.Vx,c=C.G1,S=h?(Number(h)*1E3).toString():Date.now().toString(),Y=O.lastModifiedTimestamp?(Number(O.lastModifiedTimestamp)*1E3).toString():"0",J={id:g.Jg(k,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:c,lastModifiedTimestampMillis:Y,addedTimestampMillis:S,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},q={id:g.Jg(k,"musicPlaylist"),title:O.title,playlistId:k,thumbnailDetails:O.thumbnail,visibility:j3U(O),trackCount:O.totalVideoCount,
tracks:M,downloadMetadata:J.id},V&&(((u=q)==null?0:u.entityMetadata)?q.entityMetadata.nextAutoRefreshIntervalSeconds=String(V):q&&(q.entityMetadata={nextAutoRefreshIntervalSeconds:String(V)})),g.t(H,la(D.D,{mode:"readwrite",g2:!0},function(m){var R=oN(m,q,"musicPlaylist");m=oN(m,J,"musicPlaylistDownloadMetadataEntity");return g.vs.all([R,m])}),2)):H.return(q)})},j3U=function(D){switch(D.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},UZL=function(D,O){this.D=D;
this.j=O},vF0=function(D,O){var h,V,k,C,M,c,S,Y,J,q,u,H,m;
return g.Q(function(R){switch(R.D){case 1:return h=Yu(O),V=g.Yy(O.entityKey),k=V.entityId,C=g.y(O.actionMetadata,AX_),g.g2(R,2),g.t(R,GcL(D,k,void 0,(M=C)==null?void 0:M.track,(c=C)==null?void 0:c.albumRelease),4);case 4:if((S=C)==null?0:S.playlistId){R.v3(5);break}return g.t(R,Ioe(D.D,O.entityKey),5);case 5:g.ad(R,3);break;case 2:return Y=g.fT(R),J="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Y instanceof g.KQ&&Y.type==="QUOTA_EXCEEDED"&&
(J="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),R.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,J,q));case 3:H=Number(((u=O.actionMetadata)==null?void 0:u.priority)||0)+1;var f=(f=g.y(O.actionMetadata,AX_))?{playbackDataActionMetadata:{maximumDownloadQuality:f.maximumDownloadQuality}}:void 0;m=Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",k,"playbackData",H,tXR,f);return R.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h,[m]))}})},Q3m=function(D,O){var h,V,k,C,M,c,S,Y,J,q,u,H,m,R,f;
return g.Q(function(E){switch(E.D){case 1:return h=Yu(O),V=g.Yy(O.entityKey),k=V.entityId,g.t(E,$D(D.D,O.entityKey,"musicTrack"),2);case 2:C=E.K;if(!C){M=void 0;E.v3(3);break}return g.t(E,$D(D.D,C.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:M=E.K;case 3:c=M;if(!C||!c)return E.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));Y=g.y(O.actionMetadata,AX_);g.g2(E,5);return g.t(E,GcL(D,k,c.addedTimestampMillis,(J=Y)==null?void 0:J.track,(q=Y)==null?void 0:q.albumRelease),
7);case 7:H=Number(((u=O.actionMetadata)==null?void 0:u.priority)||0)+1;S=Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",k,"playbackData",H,tXR);g.ad(E,6);break;case 5:m=g.fT(E);if(!(m instanceof Error&&m.message==="No data")){if(m instanceof Error&&m.message==="Empty response body")ku(m.message);else return R="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",f="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",m instanceof g.KQ&&m.type==="QUOTA_EXCEEDED"&&(R="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
f="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),E.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,R,f));E.v3(6);break}return g.t(E,A_(k,D.D,O,D.j),6);case 6:return E.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,S?[S]:void 0))}})},wkR=function(D,O){var h,V;
return g.Q(function(k){switch(k.D){case 1:return h=Yu(O),g.g2(k,2),V=g.Yy(O.entityKey).entityId,V==="!*$_ALL_ENTITIES_!*$"?g.t(k,t_(D.D,O,D.j),5):g.t(k,A_(V,D.D,O,D.j),6);case 6:return g.t(k,DwR(D.D,O.entityKey),5);case 5:g.ad(k,3);break;case 2:return g.fT(k),k.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return k.return(new TQ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h))}})},GcL=function(D,O,h,V,k){var C,M,c,S,Y,J;
return g.Q(function(q){switch(q.D){case 1:if(C=V){q.v3(2);break}return g.t(q,kx8([O]),3);case 3:M=q.K,c=M[0],C=$0e(c);case 2:return g.t(q,s3R(D,C,O,k,h),4);case 4:S=q.K;Y=S.musicTrackEntity;J=S.tY;var u=Pm(Y.thumbnailDetails),H=[];J&&(H=Pm(J.thumbnailDetails));return g.t(q,KB(u.concat(H)),0)}})},s3R=function(D,O,h,V,k){var C;
return g.Q(function(M){return M.D==1?(k||(k=Date.now().toString()),C={id:g.Jg(h,"musicTrackDownloadMetadataEntity"),playbackData:g.Jg(h,"playbackData"),addedTimestampMillis:k,videoDownloadContextEntity:g.Jg(h,"videoDownloadContextEntity")},V&&(O.albumRelease=V.id),g.t(M,la(D.D,{mode:"readwrite",g2:!0},function(c){var S=[],Y=oN(c,C,"musicTrackDownloadMetadataEntity");S.push(Y);Y=oN(c,O,"musicTrack");S.push(Y);V&&(c=oN(c,V,"musicAlbumRelease"),S.push(c));return g.vs.all(S)}),2)):M.D!=3?g.t(M,Hm(h,"musicTrackDownloadMetadataEntity",
D.D,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):M.return({musicTrackEntity:O,
tY:V})})},DF=function(){Xc.apply(this,arguments);
this.U="musicTrack"},Wyc=function(D,O,h){O=O===void 0?43200:O;
h=h===void 0?!0:h;var V=V===void 0?!1:V;var k,C;return g.Q(function(M){switch(M.D){case 1:if(!D.Z.Sf())return M.return([]);k=[];g.g2(M,2);return g.t(M,JrS(O,h,V),4);case 4:k=M.K;g.ad(M,3);break;case 2:g.fT(M);case 3:return C=yBc(D,k,h,"musicPlaylist"),M.return(C)}})},TCU=function(){g.dX.apply(this,arguments);
var D=this;this.events=new g.yp(this);this.D8=this.player.V();this.HF={vC5:function(){return D.D},
zN:function(){return D.zN()},
VS:function(O){return D.VS(O)}}},dZm=function(D){var O;
D=g.y((O=D.getWatchNextResponse())==null?void 0:O.currentVideoEndpoint,g.CO);if(D==null?0:D.playlistId)var h=D.playlistId;return h},zax=function(D,O){var h,V,k,C;
return g.Q(function(M){if(M.D==1){h=O.clientPlaybackNonce;V={cpn:h,offlineSourceVisualElement:g.th(O.X1||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};O.K&&(V.videoFmt=Number(O.K.itag));O.W&&(V.audioFmt=Number(O.W.itag));if((k=dZm(O))&&O.videoId){var c=O.videoId;c=k!=="PPSV"?Promise.resolve(!1):D.D.Dw(c);M=g.t(M,c,3)}else M=M.v3(2);return M}M.D!=2&&(C=M.K)&&(V.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");D.K=h;g.eL("offlinePlaybackStarted",V);g.LT(M)})};
g.e(zD,df);g.CT.Object.defineProperties(zD.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.D.entityMetadata},
set:function(D){this.D.entityMetadata=D}}});
g.e(d8x,zD);d8x.prototype.K=function(){return[]};
g.e(zt_,zD);zt_.prototype.K=function(){return[]};
g.e(nZ8,zD);nZ8.prototype.K=function(){return[]};
g.e(F00,zD);F00.prototype.K=function(){var D=[];this.D.alternateChannel&&D.push(this.D.alternateChannel);this.D.alternateChannelList&&D.push.apply(D,g.a(this.D.alternateChannelList));this.D.oneofChannelEntity&&D.push(this.D.oneofChannelEntity);return[].concat(g.a(new Set(D)))};
g.e(ybS,zD);ybS.prototype.K=function(){var D=[];this.D.entryCollection&&D.push(this.D.entryCollection);return[].concat(g.a(new Set(D)))};
g.e(iwv,df);iwv.prototype.K=function(){var D=[];this.D.video&&D.push(this.D.video);return[].concat(g.a(new Set(D)))};
g.e(rb9,zD);rb9.prototype.K=function(){var D=[];this.D.parentPlaylist&&D.push(this.D.parentPlaylist);if(this.D.entries)for(var O=g.P(this.D.entries),h=O.next();!h.done;h=O.next())D.push.apply(D,g.a((new iwv(h.value)).K()));return[].concat(g.a(new Set(D)))};
g.e(pl9,zD);pl9.prototype.K=function(){var D=[];this.D.descriptionEntity&&D.push(this.D.descriptionEntity);this.D.creators&&D.push.apply(D,g.a(this.D.creators));this.D.theBiggestFan&&D.push(this.D.theBiggestFan);return[].concat(g.a(new Set(D)))};
g.e(Nae,zD);Nae.prototype.K=function(){return[]};
g.e(oZ8,zD);oZ8.prototype.K=function(){return[]};
g.e(Zwe,zD);Zwe.prototype.K=function(){return[]};
g.e(XlS,zD);XlS.prototype.K=function(){return[]};
g.e(Ba9,zD);Ba9.prototype.K=function(){return[]};
g.e(lkC,zD);lkC.prototype.K=function(){return[]};
g.e(x8c,zD);x8c.prototype.K=function(){return[]};
g.e($8_,zD);$8_.prototype.K=function(){return[]};
g.e(IkC,zD);IkC.prototype.K=function(){return[]};
g.e(Di_,zD);Di_.prototype.K=function(){var D=[];this.D.downloadsList&&D.push(this.D.downloadsList);this.D.smartDownloadsList&&D.push(this.D.smartDownloadsList);this.D.recommendedDownloadsList&&D.push(this.D.recommendedDownloadsList);this.D.refresh&&D.push(this.D.refresh);return[].concat(g.a(new Set(D)))};
g.e(OnR,df);OnR.prototype.K=function(){var D=[];this.D.video&&D.push(this.D.video);this.D.playlist&&D.push(this.D.playlist);this.D.videoItem&&D.push(this.D.videoItem);this.D.playlistItem&&D.push(this.D.playlistItem);return[].concat(g.a(new Set(D)))};
g.e(h5c,zD);h5c.prototype.K=function(){var D=[];this.D.refresh&&D.push(this.D.refresh);if(this.D.downloads)for(var O=g.P(this.D.downloads),h=O.next();!h.done;h=O.next())D.push.apply(D,g.a((new OnR(h.value)).K()));return[].concat(g.a(new Set(D)))};
g.e(VJ9,zD);VJ9.prototype.K=function(){var D=[];this.D.localImageEntities&&D.push.apply(D,g.a(this.D.localImageEntities));return[].concat(g.a(new Set(D)))};
g.e(k$e,zD);k$e.prototype.K=function(){var D=[];this.D.playbackData&&D.push(this.D.playbackData);this.D.localImageEntities&&D.push.apply(D,g.a(this.D.localImageEntities));this.D.videoDownloadContextEntity&&D.push(this.D.videoDownloadContextEntity);return[].concat(g.a(new Set(D)))};
g.e(C2m,zD);C2m.prototype.K=function(){return[]};
g.e(MJ9,zD);MJ9.prototype.K=function(){var D=[];this.D.fakeChildren&&D.push.apply(D,g.a(this.D.fakeChildren));return[].concat(g.a(new Set(D)))};
g.e(bnC,zD);bnC.prototype.K=function(){var D=[];this.D.video&&D.push(this.D.video);this.D.playbackData&&D.push(this.D.playbackData);this.D.offlineVideoPolicy&&D.push(this.D.offlineVideoPolicy);return[].concat(g.a(new Set(D)))};
g.e(cMm,zD);cMm.prototype.K=function(){return[]};
g.e(SFm,zD);SFm.prototype.K=function(){var D=[];this.D.channelOwner&&D.push(this.D.channelOwner);this.D.videos&&D.push.apply(D,g.a(this.D.videos));this.D.collaboratorChannels&&D.push.apply(D,g.a(this.D.collaboratorChannels));this.D.downloadState&&D.push(this.D.downloadState);this.D.refresh&&D.push(this.D.refresh);return[].concat(g.a(new Set(D)))};
g.e(YFR,zD);YFR.prototype.K=function(){var D=[];this.D.video&&D.push(this.D.video);this.D.channelContributor&&D.push(this.D.channelContributor);return[].concat(g.a(new Set(D)))};
g.e(JMC,df);JMC.prototype.K=function(){var D=[];this.D.localImageEntities&&D.push.apply(D,g.a(this.D.localImageEntities));this.D.videoDownloadContextEntity&&D.push(this.D.videoDownloadContextEntity);return[].concat(g.a(new Set(D)))};
g.e(qF9,df);qF9.prototype.K=function(){var D=[];this.D.recommendedVideoMetadata&&D.push.apply(D,g.a((new JMC(this.D.recommendedVideoMetadata)).K()));return[].concat(g.a(new Set(D)))};
g.e(uSR,df);uSR.prototype.K=function(){var D=[];this.D.playbackPosition&&D.push(this.D.playbackPosition);return[].concat(g.a(new Set(D)))};
g.e(HnU,zD);HnU.prototype.K=function(){var D=[];this.D.owner&&D.push(this.D.owner);this.D.downloadState&&D.push(this.D.downloadState);this.D.userState&&D.push.apply(D,g.a((new uSR(this.D.userState)).K()));this.D.additionalMetadata&&D.push.apply(D,g.a((new qF9(this.D.additionalMetadata)).K()));return[].concat(g.a(new Set(D)))};
g.e(mim,zD);mim.prototype.K=function(){var D=[];this.D.userChannelDetails&&D.push(this.D.userChannelDetails);return[].concat(g.a(new Set(D)))};
g.e(e5L,zD);e5L.prototype.K=function(){var D=[];this.D.channelOwner&&D.push(this.D.channelOwner);this.D.playbackPosition&&D.push(this.D.playbackPosition);this.D.localImageEntities&&D.push.apply(D,g.a(this.D.localImageEntities));this.D.downloadStatus&&D.push(this.D.downloadStatus);return[].concat(g.a(new Set(D)))};
g.e(LRC,zD);LRC.prototype.K=function(){return[]};
g.e(P2R,zD);P2R.prototype.K=function(){return[]};
g.e(g3R,zD);g3R.prototype.K=function(){return[]};
g.e(R5c,zD);R5c.prototype.K=function(){return[]};
g.e(aPx,zD);aPx.prototype.K=function(){return[]};
g.e(fP0,zD);fP0.prototype.K=function(){return[]};
g.e(KRL,zD);KRL.prototype.K=function(){return[]};
g.e(E3R,zD);E3R.prototype.K=function(){return[]};
g.e(jQe,zD);jQe.prototype.K=function(){return[]};
g.e(UiS,zD);UiS.prototype.K=function(){return[]};
g.e(AM_,zD);AM_.prototype.K=function(){var D=[];this.D.trackDownloadMetadatas&&D.push.apply(D,g.a(this.D.trackDownloadMetadatas));return[].concat(g.a(new Set(D)))};
g.e(G$c,zD);
G$c.prototype.K=function(){var D=[];this.D.downloadedTracks&&D.push.apply(D,g.a(this.D.downloadedTracks));this.D.smartDownloadedTracks&&D.push.apply(D,g.a(this.D.smartDownloadedTracks));this.D.downloadedEpisodes&&D.push.apply(D,g.a(this.D.downloadedEpisodes));this.D.downloadedAlbumReleases&&D.push.apply(D,g.a(this.D.downloadedAlbumReleases));this.D.smartDownloadedAlbumReleases&&D.push.apply(D,g.a(this.D.smartDownloadedAlbumReleases));this.D.downloadedPlaylists&&D.push.apply(D,g.a(this.D.downloadedPlaylists));this.D.smartDownloadedPlaylists&&
D.push.apply(D,g.a(this.D.smartDownloadedPlaylists));this.D.metadataOnlyTracks&&D.push.apply(D,g.a(this.D.metadataOnlyTracks));return[].concat(g.a(new Set(D)))};
g.e(tJv,zD);tJv.prototype.K=function(){var D=[];this.D.trackDownloadMetadatas&&D.push.apply(D,g.a(this.D.trackDownloadMetadatas));return[].concat(g.a(new Set(D)))};
g.e(v3x,zD);v3x.prototype.K=function(){var D=[];this.D.playbackData&&D.push(this.D.playbackData);this.D.localImageEntities&&D.push.apply(D,g.a(this.D.localImageEntities));this.D.videoDownloadContextEntity&&D.push(this.D.videoDownloadContextEntity);return[].concat(g.a(new Set(D)))};
g.e(QQx,zD);QQx.prototype.K=function(){var D=[];this.D.musicLibraryStatusEntity&&D.push(this.D.musicLibraryStatusEntity);this.D.primaryArtists&&D.push.apply(D,g.a(this.D.primaryArtists));this.D.details&&D.push(this.D.details);this.D.userDetails&&D.push(this.D.userDetails);this.D.tracks&&D.push.apply(D,g.a(this.D.tracks));this.D.share&&D.push(this.D.share);this.D.downloadMetadata&&D.push(this.D.downloadMetadata);this.D.refresh&&D.push(this.D.refresh);return[].concat(g.a(new Set(D)))};
g.e(wPm,zD);wPm.prototype.K=function(){var D=[];this.D.albumRelease&&D.push(this.D.albumRelease);this.D.tracks&&D.push.apply(D,g.a(this.D.tracks));return[].concat(g.a(new Set(D)))};
g.e(sQ0,zD);sQ0.prototype.K=function(){var D=[];this.D.albumRelease&&D.push(this.D.albumRelease);return[].concat(g.a(new Set(D)))};
g.e(WR_,zD);WR_.prototype.K=function(){var D=[];this.D.details&&D.push(this.D.details);this.D.userDetails&&D.push(this.D.userDetails);return[].concat(g.a(new Set(D)))};
g.e(TV8,zD);TV8.prototype.K=function(){var D=[];this.D.parentArtist&&D.push(this.D.parentArtist);return[].concat(g.a(new Set(D)))};
g.e(diR,zD);diR.prototype.K=function(){var D=[];this.D.parentArtist&&D.push(this.D.parentArtist);return[].concat(g.a(new Set(D)))};
g.e(z5C,zD);z5C.prototype.K=function(){return[]};
g.e(n3C,zD);n3C.prototype.K=function(){return[]};
g.e(FR9,df);FR9.prototype.K=function(){var D=[];this.D.creatorEntity&&D.push(this.D.creatorEntity);return[].concat(g.a(new Set(D)))};
g.e(yMv,zD);
yMv.prototype.K=function(){var D=[];this.D.tracks&&D.push.apply(D,g.a(this.D.tracks));this.D.refresh&&D.push(this.D.refresh);this.D.musicLibraryStatusEntity&&D.push(this.D.musicLibraryStatusEntity);this.D.details&&D.push(this.D.details);this.D.downloadMetadata&&D.push(this.D.downloadMetadata);this.D.sideloadMetadata&&D.push(this.D.sideloadMetadata);this.D.userDetails&&D.push(this.D.userDetails);this.D.entryCollection&&D.push(this.D.entryCollection);this.D.share&&D.push(this.D.share);this.D.podcastShowAdditionalMetadata&&D.push.apply(D,
g.a((new FR9(this.D.podcastShowAdditionalMetadata)).K()));return[].concat(g.a(new Set(D)))};
g.e(inS,zD);inS.prototype.K=function(){return[]};
g.e(rMm,zD);
rMm.prototype.K=function(){var D=[];this.D.musicLibraryStatusEntity&&D.push(this.D.musicLibraryStatusEntity);this.D.artists&&D.push.apply(D,g.a(this.D.artists));this.D.audioModeVersion&&D.push(this.D.audioModeVersion);this.D.videoModeVersion&&D.push(this.D.videoModeVersion);this.D.userDetails&&D.push(this.D.userDetails);this.D.details&&D.push(this.D.details);this.D.albumRelease&&D.push(this.D.albumRelease);this.D.share&&D.push(this.D.share);this.D.libraryEdit&&D.push(this.D.libraryEdit);this.D.downloadMetadata&&
D.push(this.D.downloadMetadata);this.D.playbackPosition&&D.push(this.D.playbackPosition);this.D.lyrics&&D.push(this.D.lyrics);return[].concat(g.a(new Set(D)))};
g.e(pPc,zD);pPc.prototype.K=function(){var D=[];this.D.parentTrack&&D.push(this.D.parentTrack);return[].concat(g.a(new Set(D)))};
g.e(NVm,zD);NVm.prototype.K=function(){var D=[];this.D.parentTrack&&D.push(this.D.parentTrack);return[].concat(g.a(new Set(D)))};
g.e(o3e,zD);o3e.prototype.K=function(){return[]};
g.e(Zn9,zD);Zn9.prototype.K=function(){return[]};
g.e(XPx,zD);XPx.prototype.K=function(){return[]};
g.e(BVR,zD);BVR.prototype.K=function(){return[]};
g.e(lPL,zD);lPL.prototype.K=function(){var D=[];this.D.transfer&&D.push(this.D.transfer);this.D.adsPlaybackData&&D.push.apply(D,g.a(this.D.adsPlaybackData));this.D.drmLicense&&D.push(this.D.drmLicense);this.D.offlineVideoPolicy&&D.push(this.D.offlineVideoPolicy);this.D.videoDownloadContextEntity&&D.push(this.D.videoDownloadContextEntity);return[].concat(g.a(new Set(D)))};
g.e(xi0,zD);xi0.prototype.K=function(){return[]};
g.e($i_,zD);$i_.prototype.K=function(){var D=[];this.D.offlineVideoStreams&&D.push.apply(D,g.a(this.D.offlineVideoStreams));this.D.captionTrack&&D.push.apply(D,g.a(this.D.captionTrack));return[].concat(g.a(new Set(D)))};
g.e(IPC,zD);IPC.prototype.K=function(){return[]};
g.e(D2J,zD);D2J.prototype.K=function(){return[]};
g.e(O6_,zD);O6_.prototype.K=function(){return[]};
g.e(hOR,zD);hOR.prototype.K=function(){return[]};
g.e(V0R,zD);V0R.prototype.K=function(){return[]};
g.e(kp9,zD);kp9.prototype.K=function(){return[]};
g.e(CX8,zD);CX8.prototype.K=function(){return[]};
g.e(M0m,zD);M0m.prototype.K=function(){return[]};
g.e(b6J,zD);b6J.prototype.K=function(){return[]};
g.e(cwJ,zD);cwJ.prototype.K=function(){return[]};
g.e(Sq0,zD);Sq0.prototype.K=function(){return[]};
g.e(Yqc,zD);Yqc.prototype.K=function(){return[]};
g.e(Jw9,zD);Jw9.prototype.K=function(){return[]};
g.e(qqJ,zD);qqJ.prototype.K=function(){return[]};
g.e(uY_,zD);uY_.prototype.K=function(){return[]};
g.e(H6R,zD);H6R.prototype.K=function(){return[]};
g.e(m29,zD);m29.prototype.K=function(){return[]};
var qi_=["browse","music/browse","unplugged/browse"],L9_=["offline/playlist_sync_check"],VCC=["offline"],usv=["offline/offline_video_playback_position_sync"],mwU=["offline/get_playback_data_entity"],nC;FV.getInstance=function(){return g.Q(function(D){return D.return(new Promise(function(O){g.CL().then(function(h){h?(FV.instance||(FV.instance=new FV(h)),O(FV.instance)):O(void 0)})}))})};
FV.prototype.get=function(D){var O=this,h,V,k;return g.Q(function(C){if(C.D==1)return g.t(C,gYJ(O.token),2);if(C.D!=3)return h=C.K,g.t(C,h.get("prefs",D),3);V=C.K;if(!V)return C.return();k=(0,g.Ws)();return V.expirationTimestampMs<=k?C.return():C.return(V.value)})};
FV.prototype.set=function(D,O,h){h=h===void 0?31536E3:h;var V=this,k,C,M;return g.Q(function(c){if(c.D==1)return k=(0,g.Ws)(),C={key:D,value:O,expirationTimestampMs:k+h*1E3},g.t(c,gYJ(V.token),2);M=c.K;return g.t(c,g.yx(M,"prefs",C),0)})};
FV.prototype.remove=function(D){var O=this,h;return g.Q(function(V){if(V.D==1)return g.t(V,gYJ(O.token),2);h=V.K;return g.t(V,h.delete("prefs",D),0)})};
g.e(y2,g.D3);g.e(ia,EYm);ia.prototype.j=function(D,O){O=U29(O);D=(new TextEncoder).encode(JSON.stringify(D));return this.D.encrypt(D,O)};
ia.prototype.K=function(D,O){if(!(D instanceof Uint8Array))throw ROm(1);var h=new TextDecoder;O=U29(O);D=this.D.decrypt(D,O);return JSON.parse(h.decode(D))};
var AwR={accountLinkStatusEntity:Zwe,booleanEntity:nZ8,buttonEntity:cwJ,captionTrack:o3e,channelHandle:d8x,commerceAcquisitionClientPayloadEntity:Yqc,commerceCartListEntity:Jw9,contextNoteFeedEntityPayload:zt_,continuationTokenEntity:cMm,downloadQualityPickerEntity:x8c,downloadsPageRefreshTokenEntity:IkC,downloadsPageViewConfigurationEntity:LRC,downloadStatusEntity:$8_,sfvAudioItemCurrentlyPlayingEntity:D2J,emojiFountainDataEntity:M0m,emojiCustomizationSetEntity:CX8,fakeChannel:F00,fakePlaylist:ybS,
fakePlaylistEntryCollection:rb9,fakeVideo:pl9,fakeVideoDescription:Nae,featuredProductsEntity:E3R,flowStateEntity:oZ8,iconBadgeEntity:qqJ,interstitialInteractionStateEntity:Ba9,liveChatPollStateEntity:lkC,liveReactionsDataEntity:b6J,logoEntity:XlS,macroMarkerEntity:P2R,mainDownloadsLibraryEntity:Di_,mainDownloadsListEntity:h5c,mainPlaylistDownloadStateEntity:VJ9,mainPlaylistEntity:SFm,mainPlaylistVideoEntity:YFR,mainVideoDownloadStateEntity:k$e,mainVideoEntity:HnU,markersEngagementPanelSyncEntity:g3R,
markersVisibilityOverrideEntity:R5c,musicAlbumReleaseDetail:wPm,musicAlbumReleaseDownloadMetadataEntity:AM_,musicAlbumRelease:QQx,musicAlbumReleaseUserDetail:sQ0,musicArtistDetail:TV8,musicArtist:WR_,musicArtistUserDetail:diR,musicDownloadsLibraryEntity:G$c,musicLibraryEdit:z5C,musicLibraryStatusEntity:n3C,musicPlaylist:yMv,musicPlaylistDownloadMetadataEntity:tJv,musicShare:inS,musicTrackDetail:pPc,musicTrackDownloadMetadataEntity:v3x,musicTrack:rMm,musicTrackUserDetail:NVm,offlineOrchestrationActionWrapperEntity:Zn9,
offlineVideoPolicy:XPx,offlineVideoStreams:BVR,offlineabilityEntity:C2m,orchestrationWebSamplingEntity:MJ9,pageHeaderEntity:V0R,pdpStateEntity:uY_,pinnedProductEntity:jQe,playbackData:lPL,playerStateEntity:aPx,quantityIncrementerEntity:H6R,refresh:xi0,saveToPlaylistListEntity:O6_,settingEntity:hOR,suggestedFeedbackChipStateEntity:fP0,transfer:$i_,trendingOfferEntity:UiS,videoDownloadContextEntity:IPC,videoOverviewAsyncDataEntity:m29,videoPlaybackPositionEntity:Sq0,votingEntity:kp9,ytMainChannelEntity:mim,
youchatPendingResponseEntity:KRL,ytMainDownloadedVideoEntity:bnC,ytMainVideoEntity:e5L};g.e(XV,EYm);XV.prototype.j=function(D){return D};
XV.prototype.K=function(D){if(D instanceof Uint8Array)throw ROm(0);return D};
g.e(Bv,g.n);Bv.prototype.observe=function(D){var O=this;this.observers.push(D);return function(){var h=O.observers.indexOf(D);h>=0&&O.observers.splice(h,1)}};
Bv.prototype.K=function(D){i68(this,D.data)};
Bv.prototype.fF=function(){this.channel.close()};
var Z6c,ru9=new g.wB("elementsCommand");var jp=new g.wB("entityBatchUpdate");var vBC=new g.wB("downloadStatusEntity");var Z7R=new g.wB("mainPlaylistEntityActionMetadata");var xu=new g.wB("mainVideoEntityActionMetadata");var hJR=new g.wB("musicPlaylistEntityActionMetadata");var AX_=new g.wB("musicTrackEntityActionMetadata");var cXL=new g.wB("localImageEntityActionMetadata");var ds=new g.wB("playbackDataActionMetadata");var pCe=new g.wB("transferEntityActionMetadata");var GxR=new g.wB("videoPlaybackPositionEntityActionMetadata");var cu_;new g.jh;new g.jh;uBx.prototype.request=function(D,O,h){O=O===void 0?{}:O;return this.locks.request(D,O,function(V){return h(V)})};var Vh=g.zR.caches,h_,P$L;Ox.prototype.open=function(D){return Vh.open(elc(D))};
Ox.prototype.has=function(D){return Vh.has(elc(D))};
Ox.prototype.delete=function(D){return Vh.delete(elc(D))};
Ox.prototype.match=function(D,O){var h=this,V,k,C,M,c,S;return g.Q(function(Y){switch(Y.D){case 1:return g.t(Y,h.keys(),2);case 2:V=Y.K,k=g.P(V),C=k.next();case 3:if(C.done){Y.v3(5);break}M=C.value;return g.t(Y,h.open(M),6);case 6:return c=Y.K,g.t(Y,c.match(D,O),7);case 7:if(S=Y.K)return Y.return(S);C=k.next();Y.v3(3);break;case 5:return Y.return()}})};
g.e(m00,Ox);m00.prototype.keys=function(){var D,O,h,V,k,C,M,c,S;return g.Q(function(Y){if(Y.D==1)return D=[],O=g.Ok("CacheStorage keys"),g.t(Y,Vh.keys(),2);h=Y.K;V=g.P(h);for(k=V.next();!k.done;k=V.next()){C=k.value;var J=C.indexOf(":");M=J===-1?{IG:C}:{IG:C.substring(0,J),datasyncId:C.substring(J+1)};c=M.IG;S=M.datasyncId;S===O&&D.push(c)}return Y.return(D)})};g.e(CB,g.n);CB.prototype.j=function(D){this.api.F1("onOfflineOperationFailure",D.data)};
CB.prototype.W=function(D){this.api.publish("offlinetransferpause",D.data)};
CB.prototype.fF=function(){var D;(D=this.D)==null||D.close();var O;(O=this.K)==null||O.close()};aoR.prototype.D9=function(){this.D&&b1(this)};
aoR.prototype.iJ=function(){this.K&&this.K.resolve();this.j=this.D=!1;this.U()};var M6R=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var FnJ="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var x0L="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.e(gM_,sx);gM_.prototype.K=function(D){return J_(D)?fBR(this,D):qL(D)?juv(this,D):Promise.reject(Error("Unsupported action type: "+D.actionType))};g.e(Uwe,sx);Uwe.prototype.K=function(D){return qL(D)?Are(this,D):toJ(D)?tC8(this,D):u1(D)?vMv(this,D):Promise.reject(Error("Unsupported action type: "+D.actionType))};g.b=Quc.prototype;g.b.mvi=function(D){var O=this,h,V,k,C;return g.Q(function(M){if(!g.l(D.state,128))return M.v3(0);h=D.state.o1;var c=(V=h)==null?void 0:V.errorCode,S=(k=h)==null?void 0:k.Is;C=c==="net.connect"&&S===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(c==null?0:c.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.t(M,O.EZ(O.player.getVideoData().videoId,C),0)})};
g.b.EZ=function(D,O){var h=this;return g.Q(function(V){if(V.D==1){if(h.K)return V.return();h.K=!0;return O==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(Fc(h,D,!1,!0),V.v3(0)):g.t(V,nB(h,D),3)}g.A1(D,4);return g.t(V,h.D.EZ(O),0)})};
g.b.Fz=function(D){D.status===2?(D.status!==this.j&&(ABe(this.D),g.A1(D.videoId,2)),D.w$&&wzU(this.D,D.videoId,D.w$)):D.status===4?(nB(this,D.videoId),this.EZ(D.videoId,D.wg?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):D.status===1&&QZ8(this.D);this.j=D.status;this.api.F1("localmediachange",{videoId:D.videoId,status:D.status})};
g.b.YY=function(){var D=this,O;return g.Q(function(h){if(h.D==1){if(D.K)return h.return();D.K=!0;O=D.player.getVideoData().videoId;return g.t(h,nB(D,O),2)}return g.t(h,D.D.YY(),0)})};
g.b.rh=function(D){switch(D){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.b.S=function(D){return this.api.V().S(D)};g.e(nMS,sx);nMS.prototype.K=function(D){return J_(D)?yr8(this,D):qL(D)?iSx(this,D):toJ(D)?rrJ(this,D):Promise.reject(Error("Unsupported action type: "+D.actionType))};BMJ.prototype.D=function(D,O){var h=D.action.actionMetadata.priority-O.action.actionMetadata.priority;h===0&&(D.D<O.D?h=-1:D.D>O.D&&(h=1));return h};g.e(yh,g.n);yh.prototype.fF=function(){this.U&&this.U();g.n.prototype.fF.call(this)};
yh.prototype.createAction=function(D,O){var h=g.Yy(D.entityKey).entityType,V=g.v9(16);return new gs(h,V,D,O.actionId,O.rootActionId)};
yh.prototype.jT=function(D){var O=this,h,V,k,C,M,c,S,Y,J;return g.Q(function(q){if(q.D==1){if(O.Z8())return q.return();V=(h=D.offlineOrchestrationActionWrapperEntity)!=null?h:new Set;k=[];C=g.P(V);for(M=C.next();!M.done;M=C.next())c=M.value,S=g.Yy(c),Y=S.entityId,$wc(O.D,Y)||k.push(c);return g.t(q,Spc(O,k),2)}J=q.K;return g.t(q,cB9(O,J),0)})};
yh.prototype.retry=function(){var D=this;return g.Q(function(O){return g.t(O,YpS(D),0)})};qpL.prototype.Yy=function(D,O){O=O===void 0?!0:O;var h=this,V,k,C,M,c,S,Y,J;return g.Q(function(q){switch(q.D){case 1:if(!h.D)return q.return();V=[];k=g.E7(h.D.D,O);C=[];for(M={Va:0};M.Va<k.length;M={Va:M.Va},M.Va++)c=k[M.Va],S=h.D.Aj(c,"json3"),Y=g.dt(S,{withCredentials:!0,format:"RAW"},3,500).then(function(u){return function(H){H={metadata:g.qv(k[u.Va]),trackData:H.xhr.responseText};C.push(H)}}(M)).QL(function(u){ku("Caption fetch error",u)}),V.push(Y);
return g.t(q,Ta_(V),2);case 2:return g.g2(q,3),g.t(q,Osx(D,C),5);case 5:g.ad(q,0);break;case 3:J=g.fT(q),ku("Caption DB transaction error",J),g.LT(q)}})};g.e(i1,g.n);i1.prototype.fF=function(){this.K&&this.K();g.n.prototype.fF.call(this)};
i1.prototype.j=function(D){var O=this,h,V,k,C,M,c,S,Y;return g.Q(function(J){V=(h=D.transfer)!=null?h:new Set;k=[];C=g.P(V);for(M=C.next();!M.done;M=C.next())c=M.value,S=g.Yy(c),Y=S.entityId,k.push(Y);return k.length===0?J.return():g.t(J,mqC(O,k),0)})};g.e(RpR,g.n);g.b=RpR.prototype;g.b.fF=function(){this.lS&&this.lS();this.qE.dispose();this.W.dispose();this.ST&&g.l3(this.Z.HS,this.ST);this.ME&&g.l3(this.Z.HS,this.ME);g.n.prototype.fF.call(this)};
g.b.fJT=function(D){var O=this,h,V,k;return g.Q(function(C){switch(C.D){case 1:h=g.Jg(D,"transfer");if(O.D&&h===O.D.key){Fc(O.L,O.J,!0);O.W.stop();C.v3(0);break}return g.t(C,la(O.K,{mode:"readwrite",g2:!0},function(M){return rf(M,h,"transfer").then(function(c){if(c&&c.transferState!=="TRANSFER_STATE_COMPLETE"&&c.transferState!=="TRANSFER_STATE_FAILED")return c.transferState="TRANSFER_STATE_PAUSED_BY_USER",oN(M,c,"transfer").then(function(){return c})})}),3);
case 3:V=C.K;if(!V){C.v3(0);break}if(!D||!O.j){C.v3(5);break}return g.t(C,Hm(D,O.j,O.K,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.t(C,NL(O,D),7);case 7:k=C.K,Auv({videoId:D,B8:V,offlineModeType:k}),g.LT(C)}})};
g.b.IJT=function(){var D=this;if(this.D&&this.J){Fc(this.L,this.J,!1);var O=this.D,h=(O==null?0:O.key)?g.Yy(O.key).entityId:"";h&&this.j&&(new Promise(function(V,k){Hm(h,D.j,D.K,"DOWNLOAD_STATE_PAUSED").catch(function(C){k(C)})})).catch(function(V){ku("Download state setting error",V)})}this.W.stop()};
g.b.Ne=function(){this.D?KCm(this,this.D):pB(this)};
g.b.bM=function(D){var O=this;return g.Q(function(h){switch(h.D){case 1:if(!O.D){h.v3(2);break}if(O.D.transferState==="TRANSFER_STATE_COMPLETE"||O.D.transferState==="TRANSFER_STATE_FAILED"||!D.transfer||!D.transfer.has(O.D.key)){h.v3(3);break}return g.t(h,$D(O.K,O.D.key,"transfer"),4);case 4:O.D=h.K;if(O.D){h.v3(3);break}return g.t(h,E7L(O),3);case 3:if(O.D)return h.return();case 2:return g.t(h,pB(O),0)}})};
g.b.EZ=function(D,O){var h=this,V,k,C,M,c;return g.Q(function(S){switch(S.D){case 1:if(!h.D){oA(h,"onTransferFailure: "+D);S.v3(2);break}V=h.D;C=((k=V)==null?0:k.key)?g.Yy(V.key).entityId:"";a:switch(D){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var Y=!1;break a;default:Y=!0}return Y&&sZ_(h)?g.t(S,Za(h,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.t(S,
WCm(h,D),5);case 5:if(!C||!h.j){S.v3(2);break}return g.t(S,Hm(C,h.j,h.K,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.t(S,NL(h,C),9);case 9:M=S.K;Sp({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:C,B8:V,offlineModeType:M});if(!C||!h.j){S.v3(2);break}return g.t(S,Hm(C,h.j,h.K,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:rs(h),c=pB(h,!0),O&&O(c),g.LT(S)}})};
g.b.YY=function(D){var O=this,h,V,k,C,M,c,S,Y,J,q,u,H;return g.Q(function(m){switch(m.D){case 1:if(!O.D){oA(O,"onMaybeTransferStreamsExpired");m.v3(2);break}return sZ_(O)?g.t(m,Za(O,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.t(m,WCm(O,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!O.j){m.v3(2);break}h=O.D;k=((V=h)==null?0:V.key)?g.Yy(h.key).entityId:"";if(!k){m.v3(2);break}return g.t(m,Hm(k,O.j,O.K,"DOWNLOAD_STATE_FAILED"),2);case 9:return O.D||oA(O,"onMaybeTransferStreamsExpiredRetryAttempting"),
C=O.D,c=((M=C)==null?0:M.key)?g.Yy(C.key).entityId:"",g.t(m,NL(O,c),10);case 10:return S=m.K,Sp({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:c,B8:C,offlineModeType:S}),Y=sH8(),g.Z7(Y,ds,{isEnqueuedForExpiredStreamUrlRefetch:!0}),J=g.Jg(c,"playbackData"),q={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:J,actionMetadata:Y},u=aA(new gs("playbackData",c,q)),g.t(m,xD(O.K,u,"offlineOrchestrationActionWrapperEntity"),2);case 2:rs(O),H=pB(O,!0),
D&&D(H),g.LT(m)}})};
var nFv={},TEC=(nFv.TRANSFER_STATE_TRANSFERRING=1,nFv.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,nFv);g.b=Xc.prototype;g.b.zf=function(){return this.J.promise};
g.b.Fv=function(){if(this.K&&this.L)return this.J.promise;n7v(this).then(this.J.resolve).catch(this.J.reject);return this.J.promise};
g.b.Zy=function(D){var O={};return O.playbackData=new gM_(D,this.D8,this.D),O.transfer=new nMS(D,this.D8),O.videoPlaybackPositionEntity=new Uwe(D,this.D8),O};
g.b.j9=function(){var D=this;return g.Q(function(O){return D.K?g.t(O,axc(D.K),0):O.v3(0)})};
g.b.mB=function(){var D=this,O,h;return g.Q(function(V){if(V.D==1)return D.K||D.L?g.t(V,D.zf(),2):V.return();D.T!==void 0&&(g.jW(D.T),D.T=void 0);D.W!==void 0&&(g.jW(D.W),D.W=void 0);(O=D.K)==null||O.dispose();D.K=void 0;(h=D.L)==null||h.dispose();D.L=void 0;D.api.F1("onOrchestrationLostLeader");D.J=new g.jh;g.LT(V)})};
g.b.isOrchestrationLeader=function(){return this.j.D};
g.b.Dw=function(){return g.Q(function(D){return D.return(!1)})};
g.b.vP=function(D){var O=this.D;O.api.publish("offlinetransferpause",D);var h;(h=O.K)==null||h.postMessage(D)};
g.b.Ne=function(D){var O,h;return g.Q(function(V){if(V.D==1)return g.t(V,Da(),2);O=V.K;if(!O)return V.return();h=g.Jg(D,"transfer");return g.t(V,la(O,{mode:"readwrite",g2:!0},function(k){var C=rf(k,h,"transfer"),M=rf(k,g.Jg(D,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.vs.all([C,M]).then(function(c){c=g.P(c);var S=c.next().value;var Y=c.next().value;return S&&S.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(S.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",oN(k,S,"transfer").then(function(){Sp({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:D,B8:S,offlineModeType:Y==null?void 0:Y.offlineModeType});return g.vs.resolve(null)})):g.vs.resolve(null)})}),0)})};
g.b.Vo=function(D){D=D===void 0?43200:D;var O=this,h,V,k,C,M,c,S,Y;return g.Q(function(J){if(J.D==1)return O.Z.Sf()?g.t(J,Da(),2):J.return(FC9());if(J.D!=3){h=J.K;if(!h)return J.return([]);V=Date.now()/1E3;return g.t(J,IN(h,"offlineVideoPolicy"),3)}k=J.K;C=[];M=g.P(k);for(c=M.next();!c.done;c=M.next())S=c.value,Number(S.lastUpdatedTimestampSeconds)+D<=V&&(Y=g.Yy(S.key).entityId,C.push(Y));return C.length?J.return(Bm(O,C,O.U,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):J.return([])})};
g.b.deleteAll=function(){return Bm(this,["!*$_ALL_ENTITIES_!*$"],this.U,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.b.refreshAllStaleEntities=function(D){var O=this;return g.Q(function(h){return h.D==1?g.t(h,O.Vo(D),2):h.return(h.K)})};
g.b.setUpPositionSyncInterval=function(D){var O=this;this.W!==void 0&&(g.jW(this.W),this.W=void 0);var h=D!=null?D:864E5;this.W=g.Kc(function(){O.s9(h)},h)};
g.b.s9=function(D){var O=this,h,V,k,C,M,c;return g.Q(function(S){switch(S.D){case 1:return g.g2(S,2),g.t(S,FV.getInstance(),4);case 4:h=S.K;if(!h)throw Error("prefStorage is undefined");return g.t(S,h.get("psi"),5);case 5:V=S.K;C=((k=V)==null?0:k.aB)?Number(V.aB)/1E3:0;M=Date.now();if(!(C+D<=M)){S.v3(6);break}return g.t(S,Bm(O,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.ad(S,0);break;case 2:c=g.fT(S),ku("Offline manager error",c),
g.LT(S)}})};
g.b.Dr=function(){var D=this,O,h,V,k,C,M,c;return g.Q(function(S){if(S.D==1)return g.t(S,Da(),2);if(S.D!=3)return(O=S.K)?g.t(S,IN(O,"transfer"),3):S.return([]);h=S.K;V=[];k=g.P(h);for(C=k.next();!C.done;C=k.next())M=C.value,M.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&M.key&&(c=g.Yy(M.key).entityId,V.push(c));return S.return(i7L(D,V))})};
g.b.Vd=function(){return g.Q(function(D){return D.return([])})};
g.b.Kz=function(){return g.Q(function(D){g.LT(D)})};
g.b.X8=function(){return g.Q(function(D){g.LT(D)})};g.e(rBU,sx);rBU.prototype.K=function(D){return J_(D)?o78(this,D):qL(D)?Xz8(this,D):u1(D)?BEe(this,D):Promise.reject(Error("Unsupported action type: "+D.actionType))};
var l1=[10];g.e(DZL,sx);DZL.prototype.K=function(D){return J_(D)?VXC(this,D):qL(D)?kc8(this,D):u1(D)?CYx(this,D):Promise.reject(Error("Unsupported action type: "+D.actionType))};
var haS=[10];g.e(bdc,sx);bdc.prototype.K=function(D){return qL(D)?SVm(this,D):Promise.reject(Error("Unsupported action type: "+D.actionType))};g.e(YVv,Xc);g.b=YVv.prototype;g.b.Zy=function(D){var O=Xc.prototype.Zy.call(this,D);O.mainVideoEntity=new DZL(D,this.D8,this.D);O.mainPlaylistEntity=new rBU(D,this.D8,this.D);O.mainDownloadsListEntity=new bdc(D,this.D8,this.D);return O};
g.b.refreshAllStaleEntities=function(D,O){var h=this,V,k,C,M,c,S,Y,J,q,u,H;return g.Q(function(m){switch(m.D){case 1:V=[];if(!h.D8.S("web_player_offline_playlist_auto_refresh")){m.v3(2);break}return g.t(m,JXv(h,D,O),3);case 3:V=m.K;case 2:return g.t(m,FV.getInstance(),4);case 4:return k=m.K,g.t(m,(C=k)==null?void 0:C.get("sdois"),5);case 5:return M=m.K,g.t(m,(c=k)==null?void 0:c.get("lmqf"),6);case 6:S=m.K;if(!M){m.v3(7);break}J=V;q=J.concat;return g.t(m,qVJ(h,M,(Y=S)!=null?Y:"SD",D===0),8);case 8:V=
q.call(J,m.K);case 7:return u=V,H=u.concat,g.t(m,Xc.prototype.refreshAllStaleEntities.call(h,D,O),9);case 9:return V=H.call(u,m.K),m.return(V)}})};
g.b.Dw=function(D){var O,h,V,k,C,M,c,S;return g.Q(function(Y){if(Y.D==1)return g.t(Y,Da(),2);if(Y.D!=3)return(O=Y.K)?g.t(Y,$D(O,g.sn,"mainDownloadsListEntity"),3):Y.return(!1);h=Y.K;if((V=h)==null?0:(k=V.downloads)==null?0:k.length)for(C=g.Jg(D,"mainVideoEntity"),M=g.P(h.downloads),c=M.next();!c.done;c=M.next())if(S=c.value,S.videoItem===C)return Y.return(!0);return Y.return(!1)})};
g.b.Vd=function(){var D=this,O,h,V,k,C,M,c,S;return g.Q(function(Y){if(Y.D==1)return g.t(Y,Da(),2);if(Y.D!=3)return(O=Y.K)?g.t(Y,IN(O,"downloadStatusEntity"),3):Y.return([]);h=Y.K;V=[];k=g.P(h);for(C=k.next();!C.done;C=k.next())M=C.value,M.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&M.key&&(c=g.Yy(M.key).entityId,V.push(c));return V.length?(S={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},Y.return(Bm(D,V,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
S))):Y.return([])})};
g.b.X8=function(){var D;return g.Q(function(O){return O.D==1?g.t(O,Da(),2):(D=O.K)?g.t(O,la(D,{mode:"readwrite",g2:!0},function(h){return pC(h,"mainVideoEntity").then(function(V){var k=[];V=g.P(V);for(var C=V.next();!C.done;C=V.next()){C=C.value;var M=void 0;(M=C.userState)!=null&&M.playbackPosition||(M=g.Yy(C.key).entityId,M={key:g.Jg(M,"videoPlaybackPositionEntity"),videoId:M,lastPlaybackPositionSeconds:"0"},k.push(oN(h,M,"videoPlaybackPositionEntity")),C.userState={playbackPosition:M.key},k.push(oN(h,
C,"mainVideoEntity")))}return g.vs.all(k)})}),0):O.return()})};
g.b.Kz=function(){var D,O,h,V,k,C,M,c,S,Y,J,q,u,H,m,R,f,E,A,v,W,z,X,Z,hd,Yw,B,r,I,L,p,Id,aL,hx,Ad,OS,eR,lW;return g.Q(function(K){if(K.D==1)return g.t(K,Da(),2);if(K.D!=3){D=K.K;if(!D)return K.return();O=g.Jg("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.t(K,la(D,{mode:"readonly",g2:!0},function(U){return g.vs.all([rf(U,O,"mainDownloadsListEntity"),rf(U,g.sn,"mainDownloadsListEntity"),pC(U,"mainVideoEntity"),pC(U,"mainPlaylistEntity")])}),3)}h=K.K;
V=g.P(h);k=V.next().value;C=V.next().value;M=V.next().value;c=V.next().value;S=k;Y=C;J=M;q=c;u=new Set;if((H=S)==null?0:(m=H.downloads)==null?0:m.length)for(R=g.P(S.downloads),f=R.next();!f.done;f=R.next())E=f.value,A=void 0,(v=(A=E.videoItem)!=null?A:E.playlistItem)&&u.add(v);if((W=Y)==null?0:(z=W.downloads)==null?0:z.length)for(X=g.P(Y.downloads),Z=X.next();!Z.done;Z=X.next())hd=Z.value,hd.videoItem&&u.add(hd.videoItem);Yw=new Set;B=[];r=g.P(q);for(I=r.next();!I.done;I=r.next()){L=I.value;if(L.videos)for(p=
g.P(L.videos),Id=p.next();!Id.done;Id=p.next())aL=Id.value,(hx=JSON.parse(g.Yy(aL).entityId).videoId)&&Yw.add(hx);L.key&&!u.has(L.key)&&B.push(L.key)}Ad=g.P(J);for(OS=Ad.next();!OS.done;OS=Ad.next())eR=OS.value,eR.key&&!u.has(eR.key)&&(lW=g.Yy(eR.key).entityId,Yw.has(lW)||B.push(eR.key));return B.length?g.t(K,ZsU(D,B),0):K.v3(0)})};g.e(uI8,sx);uI8.prototype.K=function(D){return J_(D)?mZe(this,D):qL(D)?eaR(this,D):u1(D)?Lyx(this,D):Promise.reject(Error("Unsupported action type: "+D.actionType))};
var $u=[10];g.e(gFm,sx);gFm.prototype.K=function(D){return J_(D)?aDR(this,D):qL(D)?fDS(this,D):u1(D)?KyU(this,D):Promise.reject(Error("Unsupported action type: "+D.actionType))};
var IA=[10];g.e(UZL,sx);UZL.prototype.K=function(D){return J_(D)?vF0(this,D):qL(D)?Q3m(this,D):u1(D)?wkR(this,D):Promise.reject(Error("Unsupported action type: "+D.actionType))};
var tXR=[10];g.e(DF,Xc);DF.prototype.Zy=function(D){var O=Xc.prototype.Zy.call(this,D);O.musicTrack=new UZL(D,this.D);O.musicPlaylist=new gFm(D,this.D);O.musicAlbumRelease=new uI8(D,this.D);return O};
DF.prototype.refreshAllStaleEntities=function(D,O){var h=this,V,k,C;return g.Q(function(M){if(M.D==1)return g.t(M,Wyc(h,D,O),2);if(M.D!=3)return k=V=M.K,C=k.concat,g.t(M,Xc.prototype.refreshAllStaleEntities.call(h,D,O),3);V=C.call(k,M.K);return M.return(V)})};g.e(TCU,g.dX);g.b=TCU.prototype;g.b.create=function(){var D=this;g.F(this,this.events);g.Z$(this.D8)?this.D=new YVv(this.D8,this.player):g.pP(this.D8)&&(this.D=new DF(this.D8,this.player));this.events.G(this.player,"onPlaybackStartExternal",function(){D.zN()});
this.events.G(this.player,"videodatachange",function(){D.zN()});
this.D8.S("html5_offline_playback_position_sync")&&this.events.G(this.player,"presentingplayerstatechange",this.VS)};
g.b.Fl=function(){return!1};
g.b.yE=function(D,O,h,V){var k=this;return g.Q(function(C){return k.D?C.return(Bm(k.D,D,O,h,V)):C.return(Promise.reject())})};
g.b.deleteAll=function(){return this.D.deleteAll()};
g.b.Vo=function(D){return this.D.Vo(D)};
g.b.refreshAllStaleEntities=function(D){return this.D.refreshAllStaleEntities(D)};
g.b.setUpPositionSyncInterval=function(D){this.D.setUpPositionSyncInterval(D)};
g.b.vP=function(D){this.D.vP(D)};
g.b.Ne=function(D){return this.D.Ne(D)};
g.b.zN=function(){var D=this,O;return g.Q(function(h){O=D.player.getVideoData();return g.uA(O)?dZm(O)&&D.K!==O.clientPlaybackNonce?g.t(h,zax(D,O),0):h.v3(0):h.return()})};
g.b.VS=function(D){var O=this,h,V,k,C,M,c,S;return g.Q(function(Y){if(Y.D==1)return h=O.player.getVideoData(),V=h.F9,g.as(D,2)||g.as(D,512)?g.t(Y,Da(),2):Y.return();if(Y.D!=3){k=Y.K;if(!k)return ku("PES is undefined"),Y.return();C=h.videoId;return g.t(Y,$D(k,g.Jg(C,"mainVideoEntity"),"mainVideoEntity"),3)}M=Y.K;if(!M)return Y.return();c=Math.floor(V).toString();S={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:c}};return g.t(Y,O.yE([C],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
S),0)})};
g.b.isOrchestrationLeader=function(){return this.D.isOrchestrationLeader()};
g.b.updateDownloadState=function(D,O){var h,V,k,C;return g.Q(function(M){if(M.D==1)return g.t(M,Da(),2);h=M.K;if(!h)return ku("PES is undefined"),M.return();V=g.Yy(D);k=V.entityType;C=V.entityId;return g.t(M,Hm(C,k,h,O,!0),0)})};g.TP("offline",TCU);})(_yt_player);
